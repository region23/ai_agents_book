<div class="step active" data-step="7" id="step-7">
            <div class="step-number">07</div>
            <div class="step-card">
                <div class="step-header">
                    <div class="step-title">Адаптация, когда план не работает</div>
                    <span class="step-badge advanced">Продвинутый</span>
                </div>
                <p class="step-intro">
                    В прошлом уроке агент научился планировать. Но в реальном мире планы
                    ломаются: сервис недоступен, данные не те, клиент передумал. Хороший агент
                    не сдаётся — он адаптируется и находит обходной путь.
                </p>

                <div class="step-content">
                    <div class="analogy-block">
                        <div class="analogy-block-title">Аналогия: GPS перестраивает маршрут</div>
                        <p>
                            Вы едете по навигатору, а впереди авария — дорога перекрыта.
                            Тупой навигатор скажет: «Следуйте маршруту. Через 200 метров
                            поверните направо» — прямо в пробку. Вы будете стоять час.
                        </p>
                        <p>
                            Умный навигатор поступит иначе: определит проблему, рассчитает
                            альтернативный маршрут и перестроит путь на ходу. Вы даже не заметите,
                            что план изменился — просто приедете вовремя.
                            <strong>Адаптивный агент = умный навигатор.</strong>
                        </p>
                    </div>

                    <div class="step-detail">
                        <p>
                            В реальном мире что-то всегда идёт не по плану. API сервиса упал.
                            Данные оказались в другом формате. Пользователь уточнил задачу
                            на полпути. Внешний партнёр не ответил вовремя.
                        </p>
                        <p>
                            Обычный агент в таких ситуациях либо падает с ошибкой, либо
                            продолжает выполнять план, который уже не имеет смысла.
                            Адаптивный агент умеет три вещи:
                        </p>
                        <p>
                            <strong>1. Понять, что пошло не так</strong> — не просто увидеть ошибку,
                            а проанализировать её причину. <strong>2. Перестроить план</strong> —
                            найти альтернативный путь к цели. <strong>3. Продолжить работу</strong> —
                            выполнить новый план без потери прогресса.
                        </p>
                    </div>

                    <div class="step-detail">
                        <p>
                            Ключевой механизм — <strong>reflection</strong> (рефлексия). Это когда
                            агент не просто пытается снова, а сначала анализирует: «Почему
                            не получилось? Что я могу сделать иначе?» Без рефлексии агент будет
                            повторять одну и ту же ошибку снова и снова, как человек, который
                            дёргает закрытую дверь вместо того, чтобы поискать другой вход.
                        </p>
                    </div>

                    <div class="arch-diagram">
                        <div class="arch-row">
                            <span class="loop-node tool">План</span>
                            <span class="loop-arrow">&rarr;</span>
                            <span class="loop-node output">Выполнение</span>
                            <span class="loop-arrow">&rarr;</span>
                            <span class="loop-node error">Сбой</span>
                            <span class="loop-arrow">&rarr;</span>
                            <span class="loop-node llm">Рефлексия</span>
                            <span class="loop-arrow">&rarr;</span>
                            <span class="loop-node tool">Новый план</span>
                            <span class="loop-arrow">&rarr;</span>
                            <span class="loop-node output">Успех</span>
                        </div>
                    </div>

                    <div class="scenario-block">
                        <div class="scenario-block-title">Пример: бронирование ресторана</div>
                        <div class="scenario-line">
                            <span class="scenario-role user">Пользователь</span>
                            <span class="scenario-text">Забронируй ресторан на пятницу вечером, на 4 персоны, итальянская кухня</span>
                        </div>
                        <div class="scenario-line">
                            <span class="scenario-role llm">Агент (план)</span>
                            <span class="scenario-text">Ищу итальянские рестораны с высоким рейтингом. Попробую забронировать лучший вариант.</span>
                        </div>
                        <div class="scenario-line">
                            <span class="scenario-role tool">Бронирование</span>
                            <span class="scenario-text">Ресторан «Bella Italia» — все столики на пятницу заняты</span>
                        </div>
                        <div class="scenario-line">
                            <span class="scenario-role llm">Агент (рефлексия)</span>
                            <span class="scenario-text">Лучший вариант недоступен. Причина — пятница, высокий спрос. Расширяю поиск на другие рестораны.</span>
                        </div>
                        <div class="scenario-line">
                            <span class="scenario-role tool">Бронирование</span>
                            <span class="scenario-text">Ресторан «Тоскана» — есть столик на 2, на 4 нет</span>
                        </div>
                        <div class="scenario-line">
                            <span class="scenario-role llm">Агент (рефлексия)</span>
                            <span class="scenario-text">Столик на 4 не найден в топ-рейтинге. Расширяю поиск: рестораны с рейтингом 4.0+ вместо 4.5+</span>
                        </div>
                        <div class="scenario-line">
                            <span class="scenario-role tool">Бронирование</span>
                            <span class="scenario-text">Ресторан «Limoncello» — столик на 4 в 19:30 доступен, рейтинг 4.2</span>
                        </div>
                        <div class="scenario-line">
                            <span class="scenario-role llm">Агент</span>
                            <span class="scenario-text">Забронировал «Limoncello» на пятницу 19:30, 4 персоны. Рейтинг 4.2, итальянская кухня, адрес: ул. Пушкина, 15.</span>
                        </div>
                    </div>

                    <div class="step-detail">
                        <p>
                            Обратите внимание на рефлексию после каждой неудачи. Агент не просто
                            случайно пробует следующий вариант — он анализирует причину (высокий
                            спрос, нет больших столиков) и корректирует стратегию (снижает планку
                            рейтинга). Каждая попытка умнее предыдущей.
                        </p>
                    </div>

                    <div class="biz-example">
                        <div class="biz-example-title">Бизнес-пример: адаптивный банковский бот</div>
                        <p>
                            Клиент банка хочет перевести 50 000 рублей. Агент проверяет баланс —
                            на счёте только 35 000. Неадаптивный бот выдаст сухое: «Недостаточно
                            средств. Операция отклонена.» Клиент раздражён, звонит в поддержку.
                        </p>
                        <p>
                            Адаптивный агент действует иначе. Рефлексия: не хватает 15 000 рублей.
                            Новый план: предложить альтернативы. Агент отвечает: «На счёте 35 000.
                            Могу предложить: 1) перевести 35 000 сейчас и 15 000 после зачисления
                            зарплаты во вторник, 2) перевести со сберегательного счёта, где есть
                            22 000, 3) подождать вторника и перевести полную сумму.»
                        </p>
                        <p>
                            Клиент выбирает вариант 2 — проблема решена без звонка в поддержку.
                            Адаптация превращает тупик в решение.
                        </p>
                    </div>

                    <table class="compare-table">
                        <thead>
                            <tr>
                                <th>Критерий</th>
                                <th>Жёсткий план</th>
                                <th>Адаптивный план</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Реакция на ошибку</td>
                                <td>Останавливается или повторяет</td>
                                <td>Анализирует и перестраивает</td>
                            </tr>
                            <tr>
                                <td>Неожиданные данные</td>
                                <td>Падает с ошибкой</td>
                                <td>Адаптирует обработку</td>
                            </tr>
                            <tr>
                                <td>Изменение задачи</td>
                                <td>Продолжает по старому плану</td>
                                <td>Перепланирует с учётом нового</td>
                            </tr>
                            <tr>
                                <td>Опыт пользователя</td>
                                <td>«Ошибка, до свидания»</td>
                                <td>«Не получилось так, но вот альтернатива»</td>
                            </tr>
                            <tr>
                                <td>Стоимость ошибки</td>
                                <td>Задача не выполнена</td>
                                <td>Задача выполнена альтернативным путём</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="lite-summary">
                        <div class="lite-summary-title">Главное из этого урока</div>
                        <ul>
                            <li><strong>Реальный мир непредсказуем.</strong> Сервисы падают, данные меняются, пользователи уточняют задачи. Жёсткий план рано или поздно сломается.</li>
                            <li><strong>Хороший агент адаптируется.</strong> Вместо того чтобы сдаться при первой ошибке, адаптивный агент ищет обходной путь и продолжает работу.</li>
                            <li><strong>Рефлексия — ключевой механизм.</strong> Агент должен не просто повторять попытку, а сначала проанализировать: почему не получилось и что сделать иначе. Без анализа повторная попытка — это определение безумия.</li>
                            <li><strong>Адаптация улучшает клиентский опыт.</strong> «Вот три альтернативы» всегда лучше, чем «Ошибка, обратитесь в поддержку».</li>
                        </ul>
                    </div>

                    <div class="key-insight">
                        <strong>Ключевая мысль:</strong> План — это гипотеза, а не закон.
                        Лучшие агенты относятся к плану как к черновику: следуют ему, пока он
                        работает, и без сожалений перестраивают, когда реальность говорит иное.
                        Гибкость — это не слабость, а сила.
                    </div>
                </div>
            </div>
        </div>
