<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–ò-–∞–≥–µ–Ω—Ç—ã –¥–ª—è —Å–∞–º—ã—Ö –º–∞–ª–µ–Ω—å–∫–∏—Ö ‚Äî –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —É—á–µ–±–Ω–∏–∫</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800;900&family=Caveat:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <style>
        :root {
            --bg: #0a0a0f;
            --bg-card: #12121a;
            --bg-card-hover: #1a1a26;
            --bg-code: #0d1117;
            --border: #222233;
            --border-active: #4f46e5;
            --text: #e2e2ef;
            --text-dim: #8888a0;
            --text-bright: #ffffff;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.15);
            --green: #22c55e;
            --green-dim: rgba(34, 197, 94, 0.12);
            --orange: #f59e0b;
            --orange-dim: rgba(245, 158, 11, 0.12);
            --red: #ef4444;
            --red-dim: rgba(239, 68, 68, 0.08);
            --cyan: #06b6d4;
            --pink: #ec4899;
            --step-connector: #222233;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7;
            overflow-x: hidden;
        }

        /* ====== HERO ====== */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(ellipse at 30% 20%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(6, 182, 212, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(236, 72, 153, 0.04) 0%, transparent 60%);
            animation: heroBgDrift 20s ease-in-out infinite alternate;
        }

        @keyframes heroBgDrift {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-3%, 2%) rotate(2deg); }
        }

        .hero-content { position: relative; z-index: 1; max-width: 800px; }

        .hero-emoji {
            font-size: 5rem;
            margin-bottom: 1.5rem;
            display: block;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }

        .hero h1 {
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            font-weight: 900;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--text-bright) 0%, var(--accent) 50%, var(--cyan) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.3rem;
            font-weight: 300;
            color: var(--text-dim);
            margin-bottom: 0.8rem;
        }

        .hero-description {
            font-size: 1.05rem;
            color: var(--text-dim);
            max-width: 550px;
            margin: 0 auto 3rem;
            line-height: 1.8;
        }

        .hero-cta {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2.5rem;
            background: var(--accent);
            color: white;
            text-decoration: none;
            border-radius: 100px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
            box-shadow: 0 0 30px var(--accent-glow);
        }

        .hero-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 50px var(--accent-glow), 0 10px 40px rgba(0,0,0,0.3);
        }

        .hero-meta {
            margin-top: 3rem;
            display: flex;
            gap: 2rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .hero-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        .hero-meta-item span:first-child { font-size: 1.1rem; }

        /* ====== CONCEPT SECTION ====== */
        .concept-section {
            max-width: 900px;
            margin: 0 auto;
            padding: 6rem 2rem;
        }

        .concept-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .concept-header h2 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .concept-header p {
            color: var(--text-dim);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .loop-diagram {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 3rem 2rem;
            margin-bottom: 3rem;
            text-align: center;
        }

        .loop-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: clamp(0.75rem, 2vw, 1rem);
        }

        .loop-node {
            padding: 0.6rem 1.2rem;
            border-radius: 10px;
            font-weight: 600;
            white-space: nowrap;
        }

        .loop-node.llm { background: var(--accent-glow); color: var(--accent); border: 1px solid rgba(99,102,241,0.3); }
        .loop-node.output { background: var(--green-dim); color: var(--green); border: 1px solid rgba(34,197,94,0.3); }
        .loop-node.tool { background: var(--orange-dim); color: var(--orange); border: 1px solid rgba(245,158,11,0.3); }
        .loop-node.context { background: rgba(6,182,212,0.1); color: var(--cyan); border: 1px solid rgba(6,182,212,0.3); }

        .loop-arrow {
            color: var(--text-dim);
            font-size: 1.4rem;
            flex-shrink: 0;
        }

        .loop-label {
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            color: var(--pink);
            margin-top: 1.5rem;
            display: block;
        }

        /* ====== STEPS ====== */
        .steps-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 2rem 6rem;
        }

        .step {
            position: relative;
            padding-left: 3.5rem;
            margin-bottom: 0;
            opacity: 1;
        }

        /* Vertical connector line */
        .step::before {
            content: '';
            position: absolute;
            left: 1.15rem;
            top: 3.5rem;
            bottom: -1px;
            width: 2px;
            background: var(--step-connector);
        }

        .step:last-child::before { display: none; }

        .step-number {
            position: absolute;
            left: 0;
            top: 0.5rem;
            width: 2.4rem;
            height: 2.4rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
            border: 2px solid var(--border);
            background: var(--bg);
            color: var(--text-dim);
            z-index: 1;
            transition: all 0.4s;
        }

        .step.active .step-number {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
            box-shadow: 0 0 20px var(--accent-glow);
        }

        .step.done .step-number {
            border-color: var(--green);
            background: var(--green-dim);
            color: var(--green);
        }

        .step-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .step-card:hover {
            border-color: rgba(99, 102, 241, 0.3);
            background: var(--bg-card-hover);
        }

        .step.active .step-card {
            border-color: var(--accent);
            box-shadow: 0 0 40px var(--accent-glow);
        }

        .step-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }

        .step-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-bright);
        }

        .step-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 100px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            flex-shrink: 0;
        }

        .step-badge.beginner { background: var(--green-dim); color: var(--green); }
        .step-badge.intermediate { background: var(--orange-dim); color: var(--orange); }
        .step-badge.advanced { background: var(--red-dim); color: var(--red); }

        .step-intro {
            color: var(--text-dim);
            margin-bottom: 1.5rem;
            font-size: 1.02rem;
        }

        .step-content { display: none; }
        .step.active .step-content { display: block; }

        .step-detail {
            margin-bottom: 1.5rem;
            color: var(--text);
            font-size: 0.98rem;
        }

        .step-detail p { margin-bottom: 0.75rem; }

        .key-insight {
            background: var(--accent-glow);
            border-left: 3px solid var(--accent);
            border-radius: 0 10px 10px 0;
            padding: 1rem 1.25rem;
            margin: 1.5rem 0;
            font-size: 0.95rem;
        }

        .key-insight strong { color: var(--accent); }

        .what-happens {
            background: rgba(6, 182, 212, 0.06);
            border-left: 3px solid var(--cyan);
            border-radius: 0 10px 10px 0;
            padding: 1rem 1.25rem;
            margin: 1.5rem 0;
            font-size: 0.95rem;
        }

        .what-happens strong { color: var(--cyan); }

        .terminal-output {
            background: #000;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 1rem 1.25rem;
            margin: 1.25rem 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            line-height: 1.6;
            color: #aaa;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .terminal-output .t-green { color: #4ade80; }
        .terminal-output .t-yellow { color: #facc15; }
        .terminal-output .t-blue { color: #60a5fa; }
        .terminal-output .t-dim { color: #555; }
        .terminal-output .t-cyan { color: #22d3ee; }
        .terminal-output .t-bold { color: #fff; font-weight: 600; }

        .run-command {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(34, 197, 94, 0.06);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            margin: 1.25rem 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            flex-wrap: wrap;
        }

        .run-command .run-icon { font-size: 1rem; }
        .run-command code { color: var(--green); }
        .run-command .run-copy-btn {
            margin-left: auto;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 0.35rem 0.6rem;
            color: var(--text-dim);
            font-size: 0.7rem;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
            transition: all 0.2s;
        }
        .run-command .run-copy-btn:hover { background: rgba(255,255,255,0.12); color: var(--text); }
        .run-command .run-copy-btn.copied { background: var(--green-dim); color: var(--green); border-color: rgba(34,197,94,0.3); }

        /* Code blocks */
        .code-block {
            position: relative;
            margin: 1.25rem 0;
        }

        .code-filename {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #1a1a2e;
            border: 1px solid var(--border);
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            padding: 0.4rem 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .code-filename .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--cyan);
        }

        pre {
            background: var(--bg-code);
            border: 1px solid var(--border);
            border-radius: 0 12px 12px 12px;
            padding: 1.25rem;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            line-height: 1.7;
            color: #c9d1d9;
            tab-size: 4;
        }

        .code-block:not(:has(.code-filename)) pre {
            border-radius: 12px;
        }

        pre .kw { color: #ff7b72; }
        pre .str { color: #a5d6ff; }
        pre .fn { color: #d2a8ff; }
        pre .cm { color: #555e6b; font-style: italic; }
        pre .num { color: #79c0ff; }
        pre .type { color: #7ee787; }
        pre .op { color: #ff7b72; }
        pre .prop { color: #c9d1d9; }
        pre .param { color: #ffa657; }

        pre code.hljs {
            background: transparent;
            padding: 0;
        }

        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 0.35rem 0.6rem;
            color: var(--text-dim);
            font-size: 0.7rem;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
            transition: all 0.2s;
            z-index: 2;
        }

        .copy-btn:hover { background: rgba(255,255,255,0.12); color: var(--text); }
        .copy-btn.copied { background: var(--green-dim); color: var(--green); border-color: rgba(34,197,94,0.3); }

        /* Handwritten annotations */
        .handnote {
            font-family: 'Caveat', cursive;
            color: var(--pink);
            font-size: 1.15rem;
        }

        /* ====== TOOLTIP TERMS ====== */
        .term {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted rgba(136, 136, 160, 0.6);
            cursor: help;
        }

        .term::after {
            content: attr(data-tip);
            position: absolute;
            left: 50%;
            bottom: 140%;
            transform: translateX(-50%);
            background: #0f1118;
            color: var(--text);
            padding: 0.45rem 0.65rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            font-size: 0.75rem;
            line-height: 1.4;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease, transform 0.2s ease;
            box-shadow: 0 8px 30px rgba(0,0,0,0.35);
            z-index: 20;
        }

        .term:hover::after,
        .term:focus-visible::after {
            opacity: 1;
            transform: translateX(-50%) translateY(-4px);
        }

        .loop-node.term { border-bottom: none; }

        /* ====== PREP ====== */
        .prep-section {
            max-width: 900px;
            margin: 0 auto;
            padding: 4rem 2rem 2rem;
        }

        .prep-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .prep-header h2 {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.75rem;
        }

        .prep-header p {
            color: var(--text-dim);
            font-size: 1.05rem;
            max-width: 640px;
            margin: 0 auto;
        }

        .prep-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1rem;
        }

        .prep-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1.25rem 1.25rem 1.1rem;
        }

        .prep-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .prep-card p { color: var(--text-dim); font-size: 0.95rem; }

        .prep-note {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-dim);
        }

        /* ====== DEMO ====== */
        .demo-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(99, 102, 241, 0.12);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: var(--text);
            padding: 0.5rem 0.9rem;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Outfit', sans-serif;
            margin-top: 0.5rem;
        }

        .demo-btn:hover { background: rgba(99, 102, 241, 0.2); }

        .demo-output {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s ease;
            margin: 0;
        }

        .demo-output.visible {
            max-height: 2000px;
            opacity: 1;
            margin: 1.25rem 0;
            overflow-x: auto;
        }

        .demo-player {
            background: #0b0f14;
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1rem 1.1rem;
            color: var(--text);
            overflow: hidden;
        }

        .demo-player.demo-output.visible { overflow-x: hidden; }

        .demo-player-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .demo-player-title {
            font-weight: 700;
            font-size: 0.9rem;
        }

        .demo-player-count {
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .demo-chat-body {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            background: #000;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 0.9rem;
        }

        .chat-msg {
            display: inline-flex;
            flex-direction: column;
            gap: 0.35rem;
            padding: 0.6rem 0.75rem;
            border-radius: 10px;
            max-width: 100%;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.78rem;
            line-height: 1.6;
            white-space: pre-wrap;
            color: #c9d1d9;
            border: 1px solid rgba(255,255,255,0.08);
        }

        .chat-msg.llm { background: rgba(99, 102, 241, 0.12); }
        .chat-msg.toolcall { background: rgba(245, 158, 11, 0.12); }
        .chat-msg.toolresult { background: rgba(34, 197, 94, 0.12); }
        .chat-msg.user { background: rgba(6, 182, 212, 0.12); }

        .chat-msg-label {
            font-size: 0.65rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .demo-player-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            margin-top: 0.9rem;
        }

        .demo-step-btn {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 8px;
            padding: 0.4rem 0.8rem;
            color: var(--text);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Outfit', sans-serif;
        }

        .demo-step-btn:hover { background: rgba(255,255,255,0.12); }
        .demo-step-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        .demo-step-label {
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        .output-note {
            color: var(--text-dim);
            font-size: 0.8rem;
            margin-top: 0.5rem;
            display: none;
        }

        .output-note.visible { display: block; }

        /* ====== MINI BLOCKS ====== */
        .mini-block {
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.9rem 1.1rem;
            margin: 1rem 0;
            font-size: 0.92rem;
        }

        .mini-block.expect {
            background: rgba(34, 197, 94, 0.08);
            border-left: 3px solid var(--green);
        }

        .mini-block.trouble {
            background: rgba(245, 158, 11, 0.08);
            border-left: 3px solid var(--orange);
        }

        .mini-title {
            font-weight: 700;
            margin-bottom: 0.35rem;
        }

        /* Architecture diagram */
        .arch-diagram {
            background: var(--bg-code);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            line-height: 1.8;
            text-align: center;
        }

        .arch-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* ====== PROGRESS MAP ====== */
        .progress-map {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            z-index: 100;
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.75rem;
        }

        .progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid var(--border);
            background: transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .progress-dot.done { border-color: var(--green); background: var(--green); }
        .progress-dot.current { border-color: var(--accent); background: var(--accent); box-shadow: 0 0 8px var(--accent-glow); }

        /* ====== FOOTER ====== */
        .footer {
            text-align: center;
            padding: 4rem 2rem;
            border-top: 1px solid var(--border);
        }

        .footer-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .footer p {
            color: var(--text-dim);
            max-width: 500px;
            margin: 0 auto 2rem;
        }

        .footer-steps {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-dim);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
        }

        .footer-steps span { opacity: 0.5; }

        /* ====== RESPONSIVE ====== */
        @media (max-width: 640px) {
            .step { padding-left: 2.5rem; }
            .step-card { padding: 1.25rem; }
            pre { font-size: 0.72rem; padding: 1rem; }
            .progress-map { display: none; }
            .loop-flow { font-size: 0.7rem; }
            .hero-meta { flex-direction: column; align-items: center; gap: 0.75rem; }
        }

        /* ====== FOCUS VISIBLE ====== */
        .step-card:focus-visible,
        .progress-dot:focus-visible,
        .demo-btn:focus-visible,
        .demo-step-btn:focus-visible,
        .copy-btn:focus-visible,
        .run-copy-btn:focus-visible,
        .hero-cta:focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 3px;
        }
    </style>
</head>
<body>

<!-- ====== HERO ====== -->
<section class="hero">
    <div class="hero-content">
        <span class="hero-emoji">ü§ñ</span>
        <h1>–ò–ò-–∞–≥–µ–Ω—Ç—ã –¥–ª—è —Å–∞–º—ã—Ö –º–∞–ª–µ–Ω—å–∫–∏—Ö</h1>
        <p class="hero-subtitle">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —É—á–µ–±–Ω–∏–∫ –Ω–∞ TypeScript</p>
        <p class="hero-description">
            8 —à–∞–≥–æ–≤ –æ—Ç ¬´–ø—Ä–∏–≤–µ—Ç, <span class="term" data-tip="–ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å">LLM</span>¬ª –¥–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
            —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º, <span class="term" data-tip="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã/—Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å">tools</span> –∏
            <span class="term" data-tip="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π">human-in-the-loop</span>.
            –ù–∏–∫–∞–∫–æ–π –º–∞–≥–∏–∏ ‚Äî —Ç–æ–ª—å–∫–æ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –Ω–∞–ø–∏—à–µ—à—å —Å–∞–º.
        </p>
        <a href="#step-0" class="hero-cta">
            –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ ‚Üì
        </a>
        <div class="hero-meta">
            <div class="hero-meta-item">
                <span>‚è±</span> <span>~2 —á–∞—Å–∞</span>
            </div>
            <div class="hero-meta-item">
                <span>üì¶</span> <span>TypeScript + OpenRouter</span>
            </div>
            <div class="hero-meta-item">
                <span>üéØ</span> <span>–û—Ç –Ω—É–ª—è –¥–æ –∞–≥–µ–Ω—Ç–∞</span>
            </div>
        </div>
    </div>
</section>

<!-- ====== BEFORE START ====== -->
<section class="prep-section" id="before-start">
    <div class="prep-header">
        <h2>–ü–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º</h2>
        <p>–ü–∞—Ä–∞ –º–∏–Ω—É—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ ‚Äî –∏ –≤—Å—ë –ø–æ–π–¥—ë—Ç –≥–ª–∞–¥–∫–æ. –≠—Ç–æ –≤–∞–∂–Ω–æ, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —Ç—ã –¥–µ–ª–∞–µ—à—å –ø–µ—Ä–≤—ã–µ —à–∞–≥–∏.</p>
    </div>
    <div class="prep-grid">
        <div class="prep-card">
            <div class="prep-title">‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ</div>
            <p>Node.js 18+ –∏ npm. –ü—Ä–æ–≤–µ—Ä—å –≤–µ—Ä—Å–∏–∏: <code style="color: var(--cyan);">node -v</code> –∏ <code style="color: var(--cyan);">npm -v</code>.</p>
        </div>
        <div class="prep-card">
            <div class="prep-title">üîë OpenRouter</div>
            <p>–ù—É–∂–µ–Ω –∞–∫–∫–∞—É–Ω—Ç –∏ API‚Äë–∫–ª—é—á. –†–∞—Å—Ö–æ–¥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏, –Ω–æ –¥–ª—è –ø–µ—Ä–≤—ã—Ö —à–∞–≥–æ–≤ –æ–±—ã—á–Ω–æ —Ö–≤–∞—Ç–∞–µ—Ç –ª–∏–º–∏—Ç–∞ $1‚Äì$5. –°–ª–µ–¥–∏ –∑–∞ –±–∞–ª–∞–Ω—Å–æ–º –≤ –∫–∞–±–∏–Ω–µ—Ç–µ.</p>
        </div>
        <div class="prep-card">
            <div class="prep-title">üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–ª—é—á–∞</div>
            <p>–ö–ª—é—á —Ö—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –≤ <code style="color: var(--cyan);">.env</code>. –ù–µ –ø—É–±–ª–∏–∫—É–π –µ–≥–æ –∏ –Ω–µ –∫–æ–º–º–∏—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.</p>
        </div>
    </div>

    <div class="prep-card" style="margin-top: 1.5rem;">
        <div class="prep-title">–ë—ã—Å—Ç—Ä—ã–π —á–µ–∫‚Äë–ª–∏—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞</div>
        <div class="run-command" style="margin-top: 0.75rem;">
            <span class="run-icon">‚ñ∂</span>
            <code>mkdir simple-agent && cd simple-agent</code>
        </div>
        <div class="run-command">
            <span class="run-icon">‚ñ∂</span>
            <code>mkdir src</code>
        </div>
        <div class="code-block">
            <div class="code-filename"><span class="dot"></span>.gitignore</div>
            <pre>node_modules
.env</pre>
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <p class="prep-note">–í —É—á–µ–±–Ω–∏–∫–µ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ ¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ¬ª ‚Äî —ç—Ç–æ —Å–∏–º—É–ª—è—Ü–∏—è –≤—ã–≤–æ–¥–∞. –†–µ–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã <span class="term" data-tip="–ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å">LLM</span> –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è.</p>
    </div>
</section>

<!-- ====== CONCEPT ====== -->
<section class="concept-section" id="step-0">
    <div class="concept-header">
        <h2>–ß—Ç–æ —Ç–∞–∫–æ–µ –ò–ò-–∞–≥–µ–Ω—Ç?</h2>
        <p>–ü—Ä–µ–∂–¥–µ —á–µ–º –ø–∏—Å–∞—Ç—å –∫–æ–¥ ‚Äî —Ä–∞–∑–±–µ—Ä—ë–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–π –∏–¥–µ–µ. –û–Ω–∞ –Ω–∞ —É–¥–∏–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–∞—è.</p>
    </div>

    <div class="loop-diagram">
        <div class="loop-flow">
            <span class="loop-node llm term" data-tip="–ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å">LLM</span>
            <span class="loop-arrow">‚Üí</span>
            <span class="loop-node output term" data-tip="–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, tool_calls)">structured output</span>
            <span class="loop-arrow">‚Üí</span>
            <span class="loop-node tool term" data-tip="–í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç">execute tool</span>
            <span class="loop-arrow">‚Üí</span>
            <span class="loop-node context term" data-tip="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π">add to context</span>
            <span class="loop-arrow">‚Üí</span>
            <span class="loop-node llm term" data-tip="–ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å">LLM</span>
            <span class="loop-arrow">‚Üí ‚Ä¶</span>
        </div>
        <span class="loop-label">‚Üë –≤–æ—Ç –∏ –≤–µ—Å—å –∞–≥–µ–Ω—Ç ‚Äî —ç—Ç–æ —Ü–∏–∫–ª</span>
    </div>

    <div style="max-width: 680px; margin: 0 auto;">
        <p style="color: var(--text); margin-bottom: 1rem;">
            –ê–≥–µ–Ω—Ç ‚Äî —ç—Ç–æ <span class="term" data-tip="–ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å">LLM</span> –≤ —Ü–∏–∫–ª–µ. –ú–æ–¥–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, —Ä–µ—à–∞–µ—Ç –∫–∞–∫–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤—ã–∑–≤–∞—Ç—å (–∏–ª–∏ –Ω–µ –≤—ã–∑–≤–∞—Ç—å),
            –º—ã –≤—ã–ø–æ–ª–Ω—è–µ–º —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –¥–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ <span class="term" data-tip="–ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å">LLM</span>.
            –ò —Ç–∞–∫ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –º–æ–¥–µ–ª—å —Å–∞–º–∞ –Ω–µ —Ä–µ—à–∏—Ç, —á—Ç–æ –ø–æ—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.
        </p>
        <p style="color: var(--text-dim); margin-bottom: 1rem;">
            –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ <span class="term" data-tip="API –±–æ–ª—å—à–∏—Ö —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π">LLM API</span> (Anthropic, OpenAI) —É–∂–µ –∏–º–µ—é—Ç <strong style="color: var(--text);">–Ω–∞—Ç–∏–≤–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É <span class="term" data-tip="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã/—Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å">tools</span></strong> ‚Äî
            —Ç—ã –æ–ø–∏—Å—ã–≤–∞–µ—à—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ –∑–∞–ø—Ä–æ—Å–µ, –∏ –º–æ–¥–µ–ª—å —Å–∞–º–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç <span class="term" data-tip="–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤"><code style="color: var(--cyan);">tool_calls</code></span>
            –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ. –ù–µ –Ω—É–∂–Ω–æ –ø—Ä–æ—Å–∏—Ç—å ¬´–≤–µ—Ä–Ω–∏ JSON¬ª ‚Äî —ç—Ç–æ —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω–æ.
        </p>
        <p style="color: var(--text-dim);">
            Claude Code, Cursor, GitHub Copilot ‚Äî –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —ç—Ç–æ–º –∂–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–µ. –†–∞–∑–Ω–∏—Ü–∞ –≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ <span class="term" data-tip="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã/—Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å">tools</span>,
            quality of prompts –∏ UX –≤–æ–∫—Ä—É–≥. –Ø–¥—Ä–æ ‚Äî –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ. –î–∞–≤–∞–π –ø–æ—Å—Ç—Ä–æ–∏–º –µ–≥–æ —Å –Ω—É–ª—è.
        </p>
    </div>
</section>

<!-- ====== STEPS ====== -->
<div class="steps-container">

<!-- ======== STEP 1 ======== -->
<div class="step active" data-step="1" id="step-1">
    <div class="step-number">01</div>
    <div class="step-card">
        <div class="step-header">
        <div class="step-title">–ë–∞–∑–æ–≤—ã–π <span class="term" data-tip="–ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å">LLM</span>-–≤—ã–∑–æ–≤</div>
            <span class="step-badge beginner">–ù–∞—á–∞–ª–æ</span>
        </div>
        <p class="step-intro">
            –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ <span class="term" data-tip="–ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å">LLM</span>, –ø–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç. –ü—Ä–æ—Å—Ç–æ —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç.
        </p>

        <div class="step-content">
            <div class="step-detail">
                <p>–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—ë–º –ø—Ä–æ–µ–∫—Ç –∏ —Å—Ç–∞–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:</p>
            </div>

            <div class="run-command">
                <span class="run-icon">‚ñ∂</span>
                <code>mkdir simple-agent && cd simple-agent && npm init -y && npm install openai typescript tsx @types/node dotenv</code>
            </div>

            <div class="step-detail">
                <p>–°–æ–∑–¥–∞–π –ø–∞–ø–∫—É <code>src</code> –∏ –¥–æ–±–∞–≤—å <code>.gitignore</code>, —á—Ç–æ–±—ã —Å–ª—É—á–∞–π–Ω–æ –Ω–µ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∫–ª—é—á:</p>
            </div>

            <div class="run-command">
                <span class="run-icon">‚ñ∂</span>
                <code>mkdir src</code>
            </div>

            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>.gitignore</div>
                <pre>node_modules
.env</pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>

            <div class="step-detail">
                <p>–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–π —Ñ–∞–π–ª <code>.env</code> —Å –∫–ª—é—á–æ–º –æ—Ç OpenRouter:</p>
            </div>

            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>.env</div>
                <pre>OPENROUTER_API_KEY=sk-or-v1-–≤–∞—à-–∫–ª—é—á-–æ—Ç-openrouter</pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>

            <div class="step-detail">
                <p>–¢–µ–ø–µ—Ä—å ‚Äî –ø–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤:</p>
            </div>

            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>src/01-basic-call.ts</div>
                <pre>// src/01-basic-call.ts
import OpenAI from "openai";
import dotenv from "dotenv";

dotenv.config();

const client = new OpenAI({
    baseURL: "https://openrouter.ai/api/v1",
    apiKey: process.env.OPENROUTER_API_KEY ?? "",
});

async function main() {
    const response = await client.chat.completions.create({
        model: "anthropic/claude-sonnet-4.5",
        messages: [
            { role: "user", content: "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 2 + 2?" }
        ],
    });

    console.log(response.choices[0].message.content);
}

main();
</pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>

            <div class="run-command">
                <span class="run-icon">‚ñ∂</span>
                <code>npx tsx src/01-basic-call.ts</code>
            </div>

            <button class="demo-btn" data-demo="demo-step-1">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ</button>

            <div class="terminal-output demo-output" id="demo-step-1" aria-live="polite">
2 + 2 = 4
</div>
            <div class="output-note" data-demo-note="demo-step-1">–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞. –£ —Ç–µ–±—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–∞—á–µ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.</div>

            <div class="mini-block expect">
                <div class="mini-title">‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è</div>
                –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ (–æ–±—ã—á–Ω–æ ¬´4¬ª) –±–µ–∑ –æ—à–∏–±–æ–∫.
            </div>

            <div class="mini-block trouble">
                <div class="mini-title">üßØ –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                –ü—Ä–æ–≤–µ—Ä—å <code>OPENROUTER_API_KEY</code> –≤ <code>.env</code>, –Ω–∞–ª–∏—á–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏ –≤–µ—Ä—Å–∏–∏ <code>node</code>/<code>npm</code>.
            </div>

            <div class="key-insight">
                <strong>üí° –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:</strong> –ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ OpenRouter (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –∫–æ –≤—Å–µ–º LLM-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º),
                –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç–≤–µ—Ç. –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É <code>openai</code> ‚Äî –æ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –ª—é–±—ã–º API, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–º OpenAI-—Ñ–æ—Ä–º–∞—Ç.
            </div>
        </div>
    </div>
</div>

<!-- ======== STEP 2 ======== -->
<div class="step" data-step="2" id="step-2">
    <div class="step-number">02</div>
    <div class="step-card">
        <div class="step-header">
            <div class="step-title">–î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π Tool</div>
            <span class="step-badge beginner">–ù–∞—á–∞–ª–æ</span>
        </div>
        <p class="step-intro">
            –î–∞—ë–º –º–æ–¥–µ–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å ¬´–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å¬ª ‚Äî –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ (<span class="term" data-tip="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç/—Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª—å">tool</span>). –ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç: –º–æ–¥–µ–ª—å –Ω–µ –≤—ã–¥—É–º—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –∞ –ø—Ä–æ—Å–∏—Ç –Ω–∞—Å –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é.
        </p>

        <div class="step-content">
            <div class="step-detail">
                <p>
                    Tool –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è JSON Schema –ø—Ä—è–º–æ –≤ –∑–∞–ø—Ä–æ—Å–µ –∫ API. –ú–æ–¥–µ–ª—å –≤–∏–¥–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Ä–µ—à–∞–µ—Ç —Å–∞–º–∞ ‚Äî –Ω—É–∂–Ω–æ –ª–∏ –≤—ã–∑—ã–≤–∞—Ç—å <span class="term" data-tip="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç/—Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª—å">tool</span> –∏–ª–∏ –æ—Ç–≤–µ—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–º.
                </p>
            </div>

            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>src/02-with-tool.ts</div>
                <pre>// src/02-with-tool.ts
import OpenAI from "openai";
import dotenv from "dotenv";

dotenv.config();

const client = new OpenAI({
    baseURL: "https://openrouter.ai/api/v1",
    apiKey: process.env.OPENROUTER_API_KEY ?? "",
});

// 1. –û–ø–∏—Å—ã–≤–∞–µ–º tools ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ JSON Schema
const tools: OpenAI.ChatCompletionTool[] = [
    {
        type: "function",
        function: {
            name: "get_weather",
            description: "–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É –≤ –≥–æ—Ä–æ–¥–µ",
            parameters: {
                type: "object",
                properties: {
                    city: {
                        type: "string",
                        description: "–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞",
                    },
                },
                required: ["city"],
            },
        },
    },
];

// 2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è tool ‚Äî –æ–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
function get_weather(city: string): string {
    // –ü–æ–∫–∞ —Ñ–µ–π–∫–æ–≤–∞—è, –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ —Ä–µ–∞–ª—å–Ω—ã–π API
    const data: Record&lt;string, string&gt; = {
        "–ú–æ—Å–∫–≤–∞": "‚àí5¬∞C, —Å–Ω–µ–≥",
        "–ê–Ω–∞–ø–∞": "+8¬∞C, –æ–±–ª–∞—á–Ω–æ",
        "–õ–æ–Ω–¥–æ–Ω": "+3¬∞C, –¥–æ–∂–¥—å",
    };
    return data[city] ?? `–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥–æ—Ä–æ–¥–∞ ${city}`;
}

async function main() {
    const response = await client.chat.completions.create({
        model: "anthropic/claude-sonnet-4.5",
        messages: [
            { role: "user", content: "–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –≤ –ê–Ω–∞–ø–µ?" },
        ],
        tools,
    });

    const message = response.choices[0].message;

    // 3. –°–º–æ—Ç—Ä–∏–º —á—Ç–æ –≤–µ—Ä–Ω—É–ª–∞ –º–æ–¥–µ–ª—å
    console.log("=== –û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ ===");
    console.log("Content:", message.content);
    console.log("Tool calls:", JSON.stringify(message.tool_calls, null, 2));
}

main();
</pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>

            <div class="step-detail">
                <p>–ü–æ–¥—Å–∫–∞–∑–∫–∞: –µ—Å–ª–∏ —É–±—Ä–∞—Ç—å <code>tool_choice</code>, –º–æ–¥–µ–ª—å –±—É–¥–µ—Ç —Ä–µ—à–∞—Ç—å —Å–∞–º–∞ ‚Äî —Ç–∞–∫ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–µ–µ, –Ω–æ –¥–µ–º–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º.</p>
            </div>

            <div class="run-command">
                <span class="run-icon">‚ñ∂</span>
                <code>npx tsx src/02-with-tool.ts</code>
            </div>

            <button class="demo-btn" data-demo="demo-step-2">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ</button>

            <div class="terminal-output demo-output" id="demo-step-2" aria-live="polite">
Content:

Tool calls: [
  {
    "type": "function",
    "index": 0,
    "id": "toolu_vrtx_018LcrQKqANi7YFc3aCfyyqL",
    "function": {
      "name": "get_weather",
      "arguments": "{\"city\": \"–ê–Ω–∞–ø–∞\"}"
    }
  }
]
</div>
            <div class="output-note" data-demo-note="demo-step-2">–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞. –£ —Ç–µ–±—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–∞—á–µ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.</div>

            <div class="mini-block expect">
                <div class="mini-title">‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è</div>
                –í –≤—ã–≤–æ–¥–µ –≤–∏–¥–Ω–æ <code>tool_calls</code> —Å –≤—ã–∑–æ–≤–æ–º <code>get_weather</code> –∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º <code>city</code>.
            </div>

            <div class="mini-block trouble">
                <div class="mini-title">üßØ –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                –ï—Å–ª–∏ <code>tool_calls</code> –ø—É—Å—Ç–æ–π ‚Äî –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –µ—Å—Ç—å <code>tool_choice</code>, –∏–ª–∏ —É–∫–∞–∂–∏ –≤ –ø—Ä–æ–º–ø—Ç–µ ¬´–≤—ã–∑–æ–≤–∏ get_weather¬ª.
            </div>

            <div class="key-insight">
                <strong>üí° –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ:</strong> Content –ø—É—Å—Ç–æ–π! –ú–æ–¥–µ–ª—å –Ω–µ —Å—Ç–∞–ª–∞ –≤—ã–¥—É–º—ã–≤–∞—Ç—å –ø–æ–≥–æ–¥—É.
                –û–Ω–∞ –≤–µ—Ä–Ω—É–ª–∞ <code>tool_calls</code> —Å –∏–º–µ–Ω–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ ‚Äî –ø–æ–ø—Ä–æ—Å–∏–ª–∞ <em>–Ω–∞—Å</em> –≤—ã–ø–æ–ª–Ω–∏—Ç—å <code>get_weather</code>.
                –í–æ—Ç —ç—Ç–æ –∏ –µ—Å—Ç—å structured output ‚Äî –Ω–∞—Ç–∏–≤–Ω—ã–π, –Ω–µ –Ω—É–∂–Ω–æ –ø—Ä–æ—Å–∏—Ç—å ¬´–≤–µ—Ä–Ω–∏ JSON¬ª.
            </div>
        </div>
    </div>
</div>

<!-- ======== STEP 3 ======== -->
<div class="step" data-step="3" id="step-3">
    <div class="step-number">03</div>
    <div class="step-card">
        <div class="step-header">
            <div class="step-title">Agent Loop ‚Äî –∑–∞–º—ã–∫–∞–µ–º –ø–µ—Ç–ª—é</div>
            <span class="step-badge beginner">–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç</span>
        </div>
        <p class="step-intro">
            –í–æ—Ç —ç—Ç–æ –∏ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç–∞ –∞–≥–µ–Ω—Ç–æ–º. –ú–æ–¥–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç <span class="term" data-tip="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç/—Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª—å">tool</span> ‚Üí –º—ã –≤—ã–ø–æ–ª–Ω—è–µ–º ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ <span class="term" data-tip="–ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å">LLM</span> ‚Üí repeat.
        </p>

        <div class="step-content">
            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>src/03-agent-loop.ts</div>
                <pre>// src/03-agent-loop.ts
import OpenAI from "openai";
import dotenv from "dotenv";

dotenv.config();

const client = new OpenAI({
    baseURL: "https://openrouter.ai/api/v1",
    apiKey: process.env.OPENROUTER_API_KEY ?? "",
});

const tools: OpenAI.ChatCompletionTool[] = [
    {
        type: "function",
        function: {
            name: "get_weather",
            description: "–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É –≤ –≥–æ—Ä–æ–¥–µ",
            parameters: {
                type: "object",
                properties: {
                    city: { type: "string", description: "–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞" },
                },
                required: ["city"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "get_time",
            description: "–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –≥–æ—Ä–æ–¥–µ",
            parameters: {
                type: "object",
                properties: {
                    city: { type: "string", description: "–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞" },
                },
                required: ["city"],
            },
        },
    },
];

// –†–µ–µ—Å—Ç—Ä —Ñ—É–Ω–∫—Ü–∏–π ‚Äî –º–∞–ø–ø–∏–Ω–≥ –∏–º—è ‚Üí —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
const toolHandlers: Record&lt;string, (args: any) =&gt; string&gt; = {
    get_weather: ({ city }) =&gt; {
        const data: Record&lt;string, string&gt; = {
            "–ú–æ—Å–∫–≤–∞": "‚àí5¬∞C, —Å–Ω–µ–≥",
            "–ê–Ω–∞–ø–∞": "+8¬∞C, –æ–±–ª–∞—á–Ω–æ",
        };
        return data[city] ?? `–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è ${city}`;
    },
    get_time: ({ city }) =&gt; {
        const now = new Date();
        return `–°–µ–π—á–∞—Å –≤ ${city}: ${now.toLocaleTimeString("ru-RU")}`;
    },
};

async function agentLoop(userMessage: string) {
    // –ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    const messages: OpenAI.ChatCompletionMessageParam[] = [
        { role: "system", content: "–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ò—Å–ø–æ–ª—å–∑—É–π tools –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ." },
        { role: "user", content: userMessage },
    ];

    let iteration = 0;
    const MAX_ITERATIONS = 10; // –∑–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

    while (iteration &lt; MAX_ITERATIONS) {
        iteration++;
        console.log(`\n--- –ò—Ç–µ—Ä–∞—Ü–∏—è ${iteration} ---`);

        const response = await client.chat.completions.create({
            model: "anthropic/claude-sonnet-4.5",
            messages,
            tools,
        });

        const message = response.choices[0].message;

        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
        messages.push(message);

        // –ï—Å–ª–∏ –Ω–µ—Ç tool_calls ‚Äî –º–æ–¥–µ–ª—å —Ä–µ—à–∏–ª–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
        if (!message.tool_calls || message.tool_calls.length === 0) {
            console.log("–ê–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É.");
            console.log("–û—Ç–≤–µ—Ç:", message.content);
            return message.content;
        }

        // –í—ã–ø–æ–ª–Ω—è–µ–º –∫–∞–∂–¥—ã–π tool call
        for (const toolCall of message.tool_calls) {
            const name = toolCall.function.name;
            const args = JSON.parse(toolCall.function.arguments);

            console.log(`Tool: ${name}(${JSON.stringify(args)})`);

            const handler = toolHandlers[name];
            const result = handler
                ? handler(args)
                : `–û—à–∏–±–∫–∞: tool "${name}" –Ω–µ –Ω–∞–π–¥–µ–Ω`;

            console.log(`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result}`);

            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
            messages.push({
                role: "tool",
                tool_call_id: toolCall.id,
                content: result,
            });
        }
        // –¶–∏–∫–ª –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ LLM
    }

    console.log("–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –∏—Ç–µ—Ä–∞—Ü–∏–π!");
}

// –¢–µ—Å—Ç–∏—Ä—É–µ–º ‚Äî –∑–∞–ø—Ä–æ—Å, —Ç—Ä–µ–±—É—é—â–∏–π –î–í–ê tool call
agentLoop("–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –≤ –ú–æ—Å–∫–≤–µ –∏ –ê–Ω–∞–ø–µ? –ò —Å–∫–æ–ª—å–∫–æ —Å–µ–π—á–∞—Å –≤—Ä–µ–º–µ–Ω–∏?");
</pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>

            <div class="run-command">
                <span class="run-icon">‚ñ∂</span>
                <code>npx tsx src/03-agent-loop.ts</code>
            </div>

            <button class="demo-btn" data-demo="demo-step-3">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ</button>

            <div class="terminal-output demo-output" id="demo-step-3" aria-live="polite">

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 1 ---
Tool: get_weather({"city":"–ú–æ—Å–∫–≤–∞"})
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚àí5¬∞C, —Å–Ω–µ–≥
Tool: get_weather({"city":"–ê–Ω–∞–ø–∞"})
–†–µ–∑—É–ª—å—Ç–∞—Ç: +8¬∞C, –æ–±–ª–∞—á–Ω–æ
Tool: get_time({"city":"–ú–æ—Å–∫–≤–∞"})
–†–µ–∑—É–ª—å—Ç–∞—Ç: –°–µ–π—á–∞—Å –≤ –ú–æ—Å–∫–≤–∞: 18:11:51

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 2 ---
–û—Ç–≤–µ—Ç: –í–æ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:

**–ü–æ–≥–æ–¥–∞:**
- **–ú–æ—Å–∫–≤–∞**: ‚àí5¬∞C, —Å–Ω–µ–≥
- **–ê–Ω–∞–ø–∞**: +8¬∞C, –æ–±–ª–∞—á–Ω–æ

**–í—Ä–µ–º—è:**
- –°–µ–π—á–∞—Å –≤ –ú–æ—Å–∫–≤–µ: 18:11:51
</div>
            <div class="output-note" data-demo-note="demo-step-3">–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞. –£ —Ç–µ–±—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–∞—á–µ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.</div>

            <div class="mini-block expect">
                <div class="mini-title">‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è</div>
                –ù–∞ –ø–µ—Ä–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –µ—Å—Ç—å <code>tool_calls</code>, –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –±–µ–∑ tool‚Äë–≤—ã–∑–æ–≤–æ–≤.
            </div>

            <div class="mini-block trouble">
                <div class="mini-title">üßØ –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                –ü—Ä–æ–≤–µ—Ä—å –ø–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ (<code>JSON.parse</code>) –∏ —á—Ç–æ handlers –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å—Ç—Ä–æ–∫—É.
            </div>

            <div class="what-happens">
                <strong>üîç –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:</strong>
                <strong>–ò—Ç–µ—Ä–∞—Ü–∏—è 1</strong> ‚Äî –º–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ —Å—Ä–∞–∑—É 3 tool_calls (–ø–æ–Ω—è–ª–∞, —á—Ç–æ –Ω—É–∂–Ω—ã –≤—Å–µ —Ç—Ä–∏). –ú—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏, –¥–æ–±–∞–≤–∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç.
                <strong>–ò—Ç–µ—Ä–∞—Ü–∏—è 2</strong> ‚Äî –º–æ–¥–µ–ª—å –ø–æ–ª—É—á–∏–ª–∞ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, —Ä–µ—à–∏–ª–∞ —á—Ç–æ —Ö–≤–∞—Ç–∏—Ç, –∏ –æ—Ç–≤–µ—Ç–∏–ª–∞ —Ç–µ–∫—Å—Ç–æ–º. –¶–∏–∫–ª –∑–∞–≤–µ—Ä—à–∏–ª—Å—è.
            </div>

            <div class="key-insight">
                <strong>üí° –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:</strong>
                <code>while</code> loop ‚Äî –∫—Ä—É—Ç–∏–º—Å—è –ø–æ–∫–∞ –º–æ–¥–µ–ª—å –Ω–µ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å <code>tool_calls</code>.
                <code>messages</code> –º–∞—Å—Å–∏–≤ —Ä–∞—Å—Ç—ë—Ç ‚Äî –∫–∞–∂–¥—ã–π tool result –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è, –º–æ–¥–µ–ª—å –≤–∏–¥–∏—Ç –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é.
                –ú–æ–¥–µ–ª—å <em>—Å–∞–º–∞ —Ä–µ—à–∞–µ—Ç</em> –∫–æ–≥–¥–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.
                <code>MAX_ITERATIONS</code> ‚Äî –∑–∞—â–∏—Ç–∞, —á—Ç–æ–±—ã –∞–≥–µ–Ω—Ç –Ω–µ —É—à—ë–ª –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å.
            </div>
        </div>
    </div>
</div>

<!-- ======== STEP 4 ======== -->
<div class="step" data-step="4" id="step-4">
    <div class="step-number">04</div>
    <div class="step-card">
        <div class="step-header">
            <div class="step-title">–†–µ–∞–ª—å–Ω—ã–µ Tools ‚Äî bash –∏ —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞</div>
            <span class="step-badge intermediate">–ü—Ä–∞–∫—Ç–∏–∫–∞</span>
        </div>
        <p class="step-intro">
            –ó–∞–º–µ–Ω—è–µ–º —Ñ–µ–π–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç–æ—è—â–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏. –ê–≥–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã –∏ —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ <span class="term" data-tip="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç/—Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª—å">tools</span>.
        </p>

        <div class="step-content">
            <div class="step-detail">
                <p>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞ –∂–µ ‚Äî agent loop. –ù–æ tools —Ç–µ–ø–µ—Ä—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π:</p>
            </div>

            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>src/04-real-tools.ts</div>
                <pre>// src/04-real-tools.ts
import OpenAI from "openai";
import { execSync } from "child_process";
import { readFileSync } from "fs";
import dotenv from "dotenv";

dotenv.config();

const client = new OpenAI({
    baseURL: "https://openrouter.ai/api/v1",
    apiKey: process.env.OPENROUTER_API_KEY ?? "",
});

const tools: OpenAI.ChatCompletionTool[] = [
    {
        type: "function",
        function: {
            name: "run_bash",
            description: "–í—ã–ø–æ–ª–Ω–∏—Ç—å bash-–∫–æ–º–∞–Ω–¥—É –∏ –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –¢–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ read-only –∫–æ–º–∞–Ω–¥—ã.",
            parameters: {
                type: "object",
                properties: {
                    command: {
                        type: "string",
                        description: "Bash-–∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è",
                    },
                },
                required: ["command"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "read_file",
            description: "–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞",
            parameters: {
                type: "object",
                properties: {
                    path: {
                        type: "string",
                        description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É",
                    },
                },
                required: ["path"],
            },
        },
    },
];

const toolHandlers: Record&lt;string, (args: any) =&gt; string&gt; = {
    run_bash: ({ command }) =&gt; {
        try {
            return execSync(command, {
                encoding: "utf-8",
                timeout: 5000,
            }).trim();
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.message}`;
        }
    },
    read_file: ({ path }) =&gt; {
        try {
            return readFileSync(path, "utf-8");
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.message}`;
        }
    },
};

async function agentLoop(userMessage: string) {
    const messages: OpenAI.ChatCompletionMessageParam[] = [
        {
            role: "system",
            content: `–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ.
–ú–æ–∂–µ—à—å –≤—ã–ø–æ–ª–Ω—è—Ç—å bash-–∫–æ–º–∞–Ω–¥—ã –∏ —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã.
–û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º.`,
        },
        { role: "user", content: userMessage },
    ];

    let iteration = 0;

    while (iteration &lt; 10) {
        iteration++;
        console.log(`\n--- –ò—Ç–µ—Ä–∞—Ü–∏—è ${iteration} ---`);

        const response = await client.chat.completions.create({
            model: "anthropic/claude-sonnet-4.5",
            messages,
            tools,
        });

        const message = response.choices[0].message;
        messages.push(message);

        if (!message.tool_calls?.length) {
            console.log("\n–ê–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É.");
            console.log("–û—Ç–≤–µ—Ç:", message.content);
            return;
        }

        for (const toolCall of message.tool_calls) {
            const name = toolCall.function.name;
            const args = JSON.parse(toolCall.function.arguments);
            console.log(`Tool: ${name}(${JSON.stringify(args)})`);

            const result = toolHandlers[name]?.(args)
                ?? `Tool "${name}" –Ω–µ –Ω–∞–π–¥–µ–Ω`;

            console.log(`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result.slice(0, 200)}...`);

            messages.push({
                role: "tool",
                tool_call_id: toolCall.id,
                content: result,
            });
        }
    }
}

// –¢–µ–ø–µ—Ä—å –∞–≥–µ–Ω—Ç –º–æ–∂–µ—Ç —Ä–µ–∞–ª—å–Ω–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–≤–æ—é —Å–∏—Å—Ç–µ–º—É
agentLoop("–ü–æ—Å–º–æ—Ç—Ä–∏ —á—Ç–æ –∑–∞ –ø—Ä–æ–µ–∫—Ç –ª–µ–∂–∏—Ç –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –ö–∞–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã?");
</pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>

            <div class="step-detail">
                <p><strong>–í–∞–∂–Ω–æ:</strong> –∑–¥–µ—Å—å –µ—Å—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π sandbox —á–µ—Ä–µ–∑ allowlist –∫–æ–º–∞–Ω–¥. –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ ‚Äî –∞–≥–µ–Ω—Ç –ø–æ–ª—É—á–∏—Ç –æ—à–∏–±–∫—É –∏ —Å–º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç—å –¥—Ä—É–≥–æ–π –ø—É—Ç—å.</p>
            </div>

            <div class="run-command">
                <span class="run-icon">‚ñ∂</span>
                <code>npx tsx src/04-real-tools.ts</code>
            </div>

            <button class="demo-btn" data-demo="demo-step-4">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ</button>

            <div class="terminal-output demo-output" id="demo-step-4" aria-live="polite">

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 1 ---
Tool: run_bash({"command":"ls -la"})
‚Üí total 16
drwxr-xr-x@ 6 pavlenko  wheel  192 Feb  5 18:21 .
drwxr-xr-x@ 8 pavlenko  wheel  256 Feb  5 18:03 ..
-rw-r--r--@ 1 pavlenko  wheel   93 Feb  5 18:21 README.md
-rw-r--r--@ 1 pavlenko  wheel  143 Feb  5 18:21 package.json
drwxr-xr-x@ 3 pavlenko  wheel   96 Feb  5 18:02 services
drwxr-xr-x@ 7 pavlenko  wheel  224 Feb  5 18:00 src

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 2 ---
Tool: read_file({"path":"README.md"})
‚Üí # simple-agent

–£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ AI-–∞–≥–µ–Ω—Ç–∞.

Tool: read_file({"path":"package.json"})
‚Üí {
  "name": "simple-agent",
  "version": "1.0.0",
  "private": true,
  "description": "–£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤"
}


--- –ò—Ç–µ—Ä–∞—Ü–∏—è 3 ---
Tool: run_bash({"command":"find . -type f -name \"*.py\" -o -name \"*.js\" -o -name \"*.ts\" -o -name \"*.json\" | head -20"})
‚Üí ./package.json
./services/index.ts
./src/05-skills.ts
./src/04-real-tools.ts
./src/02-with-tool.ts
./src/03-agent-loop.ts
./src/01-basic-call.ts

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 4 ---
Tool: run_bash({"command":"tree -L 2 -I 'node_modules'"})
‚Üí –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–∞ allowlist: tree -L 2 -I 'node_modules'

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 5 ---
Tool: run_bash({"command":"ls -R"})
‚Üí README.md
package.json
services
src

./services:
index.ts

./src:
01-basic-call.ts
02-with-tool.ts
03-agent-loop.ts
04-real-tools.ts
05-skills.ts

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 6 ---
Tool: read_file({"path":"src/01-basic-call.ts"})
‚Üí // basic call example
export const add = (a:number,b:number)=&gt;a+b;

Tool: read_file({"path":"services/index.ts"})
‚Üí // service placeholder
</div>
            <div class="output-note" data-demo-note="demo-step-4">–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞. –£ —Ç–µ–±—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–∞—á–µ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.</div>

            <div class="mini-block expect">
                <div class="mini-title">‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è</div>
                –ê–≥–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–≤–æ–¥ <code>ls</code>/<code>cat</code>, –∞ –∑–∞—Ç–µ–º –∫–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç.
            </div>

            <div class="mini-block trouble">
                <div class="mini-title">üßØ –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–∞ ‚Äî –¥–æ–±–∞–≤—å –µ—ë –≤ allowlist. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ ‚Äî –ø–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã.
            </div>

            <div class="key-insight">
                <strong>üí° Resilience –∞–≥–µ–Ω—Ç–∞:</strong> –ï—Å–ª–∏ tool –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É ‚Äî –∞–≥–µ–Ω—Ç –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è.
                –û–Ω –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è, –∏—â–µ—Ç –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–º–µ—Å—Ç–æ <code>read_file</code> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç <code>cat</code> —á–µ—Ä–µ–∑ bash).
                LLM —É–º–µ–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ—à–∏–±–∫–∞–º–∏ ‚Äî —ç—Ç–æ –æ–¥–Ω–æ –∏–∑ –µ–≥–æ —Å—É–ø–µ—Ä—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π.
            </div>
        </div>
    </div>
</div>

<!-- ======== STEP 5 ======== -->
<div class="step" data-step="5" id="step-5">
    <div class="step-number">05</div>
    <div class="step-card">
        <div class="step-header">
            <div class="step-title">Skills ‚Äî –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</div>
            <span class="step-badge intermediate">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</span>
        </div>
        <p class="step-intro">
            <span class="term" data-tip="–ü–∞–∫–µ—Ç: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ + tools + –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏">Skill</span> ‚Äî —ç—Ç–æ tool + –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è. –ù–∞–±–æ—Ä —Å–≤—è–∑–∞–Ω–Ω—ã—Ö capabilities –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞–¥–∞—á—É. –ê–≥–µ–Ω—Ç –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è ‚Äî –º–µ–Ω—è—é—Ç—Å—è skills.
        </p>

        <div class="step-content">
            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>src/05-skills.ts</div>
                <pre>// src/05-skills.ts
import OpenAI from "openai";
import { execSync } from "child_process";
import { readFileSync, writeFileSync, existsSync } from "fs";
import dotenv from "dotenv";

dotenv.config();

const client = new OpenAI({
    baseURL: "https://openrouter.ai/api/v1",
    apiKey: process.env.OPENROUTER_API_KEY ?? "",
});

// === SKILL: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ===
interface Skill {
    name: string;
    description: string;           // –¥–ª—è system prompt
    tools: OpenAI.ChatCompletionTool[];
    handlers: Record&lt;string, (args: any) =&gt; string&gt;;
}

// === SKILL: —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ ===
const filesystemSkill: Skill = {
    name: "filesystem",
    description: "–£–º–µ–µ—à—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ñ–∞–π–ª–∞–º–∏: —á–∏—Ç–∞—Ç—å, –ø–∏—Å–∞—Ç—å, –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.",
    tools: [
        {
            type: "function",
            function: {
                name: "read_file",
                description: "–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª",
                parameters: {
                    type: "object",
                    properties: {
                        path: { type: "string", description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É" },
                    },
                    required: ["path"],
                },
            },
        },
        {
            type: "function",
            function: {
                name: "write_file",
                description: "–ó–∞–ø–∏—Å–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ —Ñ–∞–π–ª",
                parameters: {
                    type: "object",
                    properties: {
                        path: { type: "string", description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É" },
                        content: { type: "string", description: "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ" },
                    },
                    required: ["path", "content"],
                },
            },
        },
        {
            type: "function",
            function: {
                name: "list_dir",
                description: "–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏",
                parameters: {
                    type: "object",
                    properties: {
                        path: { type: "string", description: "–ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" },
                    },
                    required: ["path"],
                },
            },
        },
    ],
    handlers: {
        read_file: ({ path }) =&gt; {
            try { return readFileSync(path, "utf-8"); }
            catch (e: any) { return `–û—à–∏–±–∫–∞: ${e.message}`; }
        },
        write_file: ({ path, content }) =&gt; {
            try { writeFileSync(path, content); return `–§–∞–π–ª ${path} –∑–∞–ø–∏—Å–∞–Ω`; }
            catch (e: any) { return `–û—à–∏–±–∫–∞: ${e.message}`; }
        },
        list_dir: ({ path }) =&gt; {
            try { return execSync(`ls -la ${path}`, { encoding: "utf-8" }); }
            catch (e: any) { return `–û—à–∏–±–∫–∞: ${e.message}`; }
        },
    },
};

// === SKILL: bash ===
const bashSkill: Skill = {
    name: "bash",
    description: "–£–º–µ–µ—à—å –≤—ã–ø–æ–ª–Ω—è—Ç—å bash-–∫–æ–º–∞–Ω–¥—ã –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.",
    tools: [
        {
            type: "function",
            function: {
                name: "run_bash",
                description: "–í—ã–ø–æ–ª–Ω–∏—Ç—å bash-–∫–æ–º–∞–Ω–¥—É",
                parameters: {
                    type: "object",
                    properties: {
                        command: { type: "string", description: "–ö–æ–º–∞–Ω–¥–∞" },
                    },
                    required: ["command"],
                },
            },
        },
    ],
    handlers: {
        run_bash: ({ command }) =&gt; {
            try {
                return execSync(command, { encoding: "utf-8", timeout: 5000 }).trim();
            } catch (e: any) { return `–û—à–∏–±–∫–∞: ${e.message}`; }
        },
    },
};

// === SKILL: –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ ===
const mathSkill: Skill = {
    name: "math",
    description: "–£–º–µ–µ—à—å –≤—ã—á–∏—Å–ª—è—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è.",
    tools: [
        {
            type: "function",
            function: {
                name: "calculate",
                description: "–í—ã—á–∏—Å–ª–∏—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ",
                parameters: {
                    type: "object",
                    properties: {
                        expression: { type: "string", description: "–í—ã—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä: 2 * (3 + 4)" },
                    },
                    required: ["expression"],
                },
            },
        },
    ],
    handlers: {
        calculate: ({ expression }) =&gt; {
            try { return String(eval(expression)); }
            catch (e: any) { return `–û—à–∏–±–∫–∞: ${e.message}`; }
        },
    },
};

// === –ê–ì–ï–ù–¢ —Å –ø–æ–¥–∫–ª—é—á–∞–µ–º—ã–º–∏ skills ===
function createAgent(skills: Skill[]) {
    // –°–æ–±–∏—Ä–∞–µ–º tools –∏ handlers –∏–∑ –≤—Å–µ—Ö skills
    const allTools = skills.flatMap(s =&gt; s.tools);
    const allHandlers = Object.assign({}, ...skills.map(s =&gt; s.handlers));

    // –°–æ–±–∏—Ä–∞–µ–º system prompt –∏–∑ –æ–ø–∏—Å–∞–Ω–∏–π skills
    const skillDescriptions = skills
        .map(s =&gt; `- ${s.name}: ${s.description}`)
        .join("\n");

    const systemPrompt = `–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –£ —Ç–µ–±—è –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –Ω–∞–≤—ã–∫–∏:
${skillDescriptions}
–ò—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º.`;

    return async function run(userMessage: string) {
        const messages: OpenAI.ChatCompletionMessageParam[] = [
            { role: "system", content: systemPrompt },
            { role: "user", content: userMessage },
        ];

        let iteration = 0;

        while (iteration &lt; 10) {
            iteration++;
            console.log(`\n--- –ò—Ç–µ—Ä–∞—Ü–∏—è ${iteration} ---`);

            const response = await client.chat.completions.create({
                model: "anthropic/claude-sonnet-4.5",
                messages,
                tools: allTools,
            });

            const message = response.choices[0].message;
            messages.push(message);

            if (!message.tool_calls?.length) {
                console.log("\n–û—Ç–≤–µ—Ç:", message.content);
                return message.content;
            }

            for (const toolCall of message.tool_calls) {
                const name = toolCall.function.name;
                const args = JSON.parse(toolCall.function.arguments);
                console.log(`Tool: ${name}(${JSON.stringify(args)})`);

                const result = allHandlers[name]?.(args)
                    ?? `Tool "${name}" –Ω–µ –Ω–∞–π–¥–µ–Ω`;
                console.log(`‚Üí ${result.slice(0, 150)}`);

                messages.push({
                    role: "tool",
                    tool_call_id: toolCall.id,
                    content: result,
                });
            }
        }
    };
}

// === –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ===
async function main() {
    // –°–æ–∑–¥–∞—ë–º –∞–≥–µ–Ω—Ç–∞ —Å –Ω—É–∂–Ω—ã–º–∏ skills
    const agent = createAgent([filesystemSkill, bashSkill, mathSkill]);

    // –ê–≥–µ–Ω—Ç —Å–∞–º —Ä–µ—à–∏—Ç –∫–∞–∫–∏–µ tools –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
    await agent(
        "–ü–æ—Å–º–æ—Ç—Ä–∏ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, " +
        "–ø–æ—Å—á–∏—Ç–∞–π –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤–æ –≤—Å–µ—Ö .ts —Ñ–∞–π–ª–∞—Ö –≤ src/, " +
        "–∏ —Å–æ–∑–¥–∞–π —Ñ–∞–π–ª STATS.md —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞."
    );
}

main();
</pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>

            <button class="demo-btn" data-demo="demo-step-5">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ</button>

            <div class="terminal-output demo-output" id="demo-step-5" aria-live="polite">

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 1 ---
list_dir({"path":"."})
README.md
package.json
services
src
list_dir({"path":"src"})
01-basic-call.ts
02-with-tool.ts
03-agent-loop.ts
04-real-tools.ts
05-skills.ts

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 2 ---
run_bash({"command":"wc -l src/*.ts"})
2 src/01-basic-call.ts
       2 src/02-with-tool.ts
       2 src/03-agent-loop.ts
       2 src/04-real-tools.ts
       2 src/05-skills.ts
      10 total
run_bash({"command":"find src -name \"*.ts\" -type f"})
src/05-skills.ts
src/04-real-tools.ts
src/02-with-tool.ts
src/03-agent-loop.ts
src/01-basic-call.ts

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 3 ---
run_bash({"command":"cat src/01-basic-call.ts"})
// basic call example
export const add = (a:number,b:number)=&gt;a+b;
run_bash({"command":"cat src/02-with-tool.ts"})
// tool example
export const tool = () =&gt; "ok";
run_bash({"command":"cat src/03-agent-loop.ts"})
// agent loop example
export const loop = () =&gt; true;
run_bash({"command":"cat src/04-real-tools.ts"})
// real tools example
export const run = () =&gt; null;
run_bash({"command":"cat src/05-skills.ts"})
// skills example
export const skill = {};

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 4 ---
write_file({"path":"STATS.md","content":"# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞

## –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á—ë—Ç–∞:** 2024  
**–ü–∞–ø–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:** `src/`

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ñ–∞–π–ª–∞–º

| –§–∞–π–ª | –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------------|----------|
| `01-basic-call.ts` | 2 | –ü—Ä–∏–º–µ—Ä –±–∞–∑–æ–≤–æ–≥–æ –≤—ã–∑–æ–≤–∞ |
| `02-with-tool.ts` | 2 | –ü—Ä–∏–º–µ—Ä —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º |
| `03-agent-loop.ts` | 2 | –ü—Ä–∏–º–µ—Ä –∞–≥–µ–Ω—Ç—Å–∫–æ–≥–æ —Ü–∏–∫–ª–∞ |
| `04-real-tools.ts` | 2 | –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ |
| `05-skills.ts` | 2 | –ü—Ä–∏–º–µ—Ä –Ω–∞–≤—ã–∫–æ–≤ |

## –ò—Ç–æ–≥–æ

- **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤:** 5
- **–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞:** 10
- **–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:** 2 —Å—Ç—Ä–æ–∫–∏
- **–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è:** TypeScript

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ 01-basic-call.ts
‚îú‚îÄ‚îÄ 02-with-tool.ts
‚îú‚îÄ‚îÄ 03-agent-loop.ts
‚îú‚îÄ‚îÄ 04-real-tools.ts
‚îî‚îÄ‚îÄ 05-skills.ts
```

---
*–û—Ç—á—ë—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏*
"})
OK: –∑–∞–ø–∏—Å–∞–Ω STATS.md

--- –ò—Ç–µ—Ä–∞—Ü–∏—è 5 ---
–ì–æ—Ç–æ–≤–æ! ‚úÖ 

–Ø —Å–æ–∑–¥–∞–ª —Ñ–∞–π–ª **STATS.md** —Å –∫—Ä–∞—Ç–∫–∏–º –æ—Ç—á—ë—Ç–æ–º –æ –∫–æ–¥–µ –≤ –ø–∞–ø–∫–µ `src`. 

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- üìÅ –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: **5**
- üìù –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞: **10**
- üìä –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: **2 —Å—Ç—Ä–æ–∫–∏**
- üíª –Ø–∑—ã–∫: **TypeScript**

–í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π (–±–∞–∑–æ–≤—ã–π –≤—ã–∑–æ–≤, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∞–≥–µ–Ω—Ç—Å–∫–∏–π —Ü–∏–∫–ª, –Ω–∞–≤—ã–∫–∏).
</div>
            <div class="output-note" data-demo-note="demo-step-5">–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞. –£ —Ç–µ–±—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–∞—á–µ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.</div>

            <div class="mini-block expect">
                <div class="mini-title">‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è</div>
                –ü–æ–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –∞–≥–µ–Ω—Ç –º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –∏–∑ –º–æ–¥—É–ª–µ–π: skills –¥–æ–±–∞–≤–ª—è—é—Ç tools –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.
            </div>

            <div class="mini-block trouble">
                <div class="mini-title">üßØ –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                –ï—Å–ª–∏ –¥–µ–ª–∞–µ—à—å —Ä–∞–±–æ—á—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é ‚Äî –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –∏–º—ë–Ω tools –º–µ–∂–¥—É skills.
            </div>

            <div class="key-insight">
                <strong>üí° –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:</strong>
                <code>createAgent([...skills])</code> ‚Äî –∏ –≥–æ—Ç–æ–≤–æ. –•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å API ‚Äî —Å–æ–∑–¥–∞—ë—à—å –Ω–æ–≤—ã–π Skill.
                –•–æ—á–µ—à—å —É–±—Ä–∞—Ç—å bash ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—à—å. –ê–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç tools –∏–∑ —Ä–∞–∑–Ω—ã—Ö skills –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.
            </div>
        </div>
    </div>
</div>

<!-- ======== STEP 6 ======== -->
<div class="step" data-step="6" id="step-6">
    <div class="step-number">06</div>
    <div class="step-card">
        <div class="step-header">
        <div class="step-title">Multi-step Planning</div>
            <span class="step-badge advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</span>
        </div>
        <p class="step-intro">
            –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å, –∞–≥–µ–Ω—Ç —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–ª–∞–Ω. –î–≤–∞ –ø–æ–¥—Ö–æ–¥–∞: <span class="term" data-tip="–°–Ω–∞—á–∞–ª–∞ –ø–ª–∞–Ω, –ø–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ —à–∞–≥–∞–º">Plan-then-Execute</span> –∏ <span class="term" data-tip="–ß–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –∏ –¥–µ–π—Å—Ç–≤–∏–π">ReAct</span>.
        </p>

        <div class="step-content">
            <div class="arch-diagram">
                <div class="arch-row">
                    <span class="loop-node llm">Plan-then-Execute</span>
                </div>
                <div style="color: var(--text-dim); margin: 0.5rem 0;">–û—Ç–¥–µ–ª—å–Ω—ã–π LLM-–≤—ã–∑–æ–≤ –¥–ª—è –ø–ª–∞–Ω–∞ ‚Üí –ø–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
                <div class="arch-row" style="margin-top: 1rem;">
                    <span class="loop-node output">ReAct</span>
                </div>
                <div style="color: var(--text-dim); margin: 0.5rem 0;">Think ‚Üí Act ‚Üí Think ‚Üí Act –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ</div>
            </div>

            <div class="step-detail">
                <p><strong><span class="term" data-tip="–°–Ω–∞—á–∞–ª–∞ –ø–ª–∞–Ω, –ø–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ —à–∞–≥–∞–º">Plan-then-Execute</span></strong> ‚Äî –¥–≤–∞ —ç—Ç–∞–ø–∞. –°–Ω–∞—á–∞–ª–∞ <span class="term" data-tip="–ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å">LLM</span> (–±–µ–∑ tools) —Å–æ–∑–¥–∞—ë—Ç JSON-–ø–ª–∞–Ω. –ü–æ—Ç–æ–º –¥—Ä—É–≥–æ–π –≤—ã–∑–æ–≤ –ø–æ–ª—É—á–∞–µ—Ç –ø–ª–∞–Ω –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ —à–∞–≥–∞–º.</p>
                <p><strong><span class="term" data-tip="–ß–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –∏ –¥–µ–π—Å—Ç–≤–∏–π">ReAct</span></strong> ‚Äî –æ–¥–∏–Ω —Ü–∏–∫–ª, –Ω–æ —Å <code>think</code> tool. –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º –∞–≥–µ–Ω—Ç ¬´–¥—É–º–∞–µ—Ç –≤—Å–ª—É—Ö¬ª: —á—Ç–æ –∑–Ω–∞—é, —á—Ç–æ –¥–µ–ª–∞—Ç—å, –ø–æ—á–µ–º—É.</p>
            </div>

            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>think tool ‚Äî —Ö–∏—Ç—Ä—ã–π –ø—Ä–∏—ë–º</div>
                <pre><span class="cm">// Think tool –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç! –ü—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "OK".</span>
<span class="cm">// –ù–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ–¥–µ–ª—å –í–ï–†–ë–ê–õ–ò–ó–û–í–ê–¢–¨ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ</span>
<span class="cm">// –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º ‚Äî –∏ —ç—Ç–æ —Å–∏–ª—å–Ω–æ –ø–æ–≤—ã—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ.</span>
{
    <span class="prop">name</span>: <span class="str">"think"</span>,
    <span class="prop">description</span>: <span class="str">"–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–ª–æ–∫–Ω–æ—Ç –¥–ª—è —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π"</span>,
}

<span class="cm">// Handler:</span>
<span class="fn">think</span>: () =&gt; <span class="str">"OK"</span>  <span class="cm">// –≤–æ—Ç –∏ –≤—Å—ë</span></pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>
            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>src/06-planning.ts</div>
                <pre>// src/06-planning.ts
// –ê–≥–µ–Ω—Ç —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º: —Å–Ω–∞—á–∞–ª–∞ –¥—É–º–∞–µ—Ç, –ø–æ—Ç–æ–º –¥–µ–ª–∞–µ—Ç
import OpenAI from "openai";
import { execSync } from "child_process";
import { readFileSync, writeFileSync } from "fs";
import dotenv from "dotenv";

dotenv.config();

const client = new OpenAI({
    baseURL: "https://openrouter.ai/api/v1",
    apiKey: process.env.OPENROUTER_API_KEY ?? "",
});

const MODEL = "anthropic/claude-sonnet-4.5";

// ============================================================
// TOOLS (—Ç–µ –∂–µ —á—Ç–æ –≤ 05, –Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º think tool)
// ============================================================

const tools: OpenAI.ChatCompletionTool[] = [
    {
        type: "function",
        function: {
            name: "think",
            description:
                "–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —á—Ç–æ–±—ã –ø–æ–¥—É–º–∞—Ç—å, —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –ø–æ—Ä–∞—Å—Å—É–∂–¥–∞—Ç—å. " +
                "–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –≤–∏–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Äî —ç—Ç–æ —Ç–≤–æ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–ª–æ–∫–Ω–æ—Ç.",
            parameters: {
                type: "object",
                properties: {
                    thought: {
                        type: "string",
                        description: "–¢–≤–æ–∏ –º—ã—Å–ª–∏, –ø–ª–∞–Ω, —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è",
                    },
                },
                required: ["thought"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "run_bash",
            description: "–í—ã–ø–æ–ª–Ω–∏—Ç—å bash-–∫–æ–º–∞–Ω–¥—É",
            parameters: {
                type: "object",
                properties: {
                    command: { type: "string", description: "–ö–æ–º–∞–Ω–¥–∞" },
                },
                required: ["command"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "read_file",
            description: "–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª",
            parameters: {
                type: "object",
                properties: {
                    path: { type: "string", description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É" },
                },
                required: ["path"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "write_file",
            description: "–ó–∞–ø–∏—Å–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ —Ñ–∞–π–ª",
            parameters: {
                type: "object",
                properties: {
                    path: { type: "string", description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É" },
                    content: { type: "string", description: "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ" },
                },
                required: ["path", "content"],
            },
        },
    },
];

const toolHandlers: Record&lt;string, (args: any) =&gt; string&gt; = {
    think: ({ thought }) =&gt; {
        // Think tool –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.
        // –í—Å—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ç–æ–º, —á—Ç–æ –º–æ–¥–µ–ª—å "–ø—Ä–æ–≥–æ–≤–æ—Ä–∏–ª–∞" –º—ã—Å–ª—å.
        return "OK";
    },
    run_bash: ({ command }) =&gt; {
        try {
            return execSync(command, { encoding: "utf-8", timeout: 10000 }).trim();
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.stderr || e.message}`;
        }
    },
    read_file: ({ path }) =&gt; {
        try {
            return readFileSync(path, "utf-8");
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.message}`;
        }
    },
    write_file: ({ path, content }) =&gt; {
        try {
            writeFileSync(path, content, "utf-8");
            return `‚úÖ –§–∞–π–ª ${path} –∑–∞–ø–∏—Å–∞–Ω (${content.length} –±–∞–π—Ç)`;
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.message}`;
        }
    },
};

// ============================================================
// –ü–û–î–•–û–î 1: Plan-then-Execute
// –î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —ç—Ç–∞–ø–∞: —Å–Ω–∞—á–∞–ª–∞ –ø–ª–∞–Ω, –ø–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
// ============================================================

async function planThenExecute(userMessage: string) {
    console.log("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    console.log("‚ïë   –ü–û–î–•–û–î 1: Plan-then-Execute            ‚ïë");
    console.log("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");

    // --- –§–ê–ó–ê 1: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–±–µ–∑ tools!) ---
    console.log("üìã –§–ê–ó–ê 1: –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–ï\n");

    const planResponse = await client.chat.completions.create({
        model: MODEL,
        messages: [
            {
                role: "system",
                content: `–¢—ã –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á. –ü–æ–ª—É—á–∏–≤ –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ—Å—Ç–∞–≤—å –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω.

–ü—Ä–∞–≤–∏–ª–∞:
- –ö–∞–∂–¥—ã–π —à–∞–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –≤—ã–ø–æ–ª–Ω–∏–º—ã–º
- –ò—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º–∞—Ç JSON
- –ù–ï –≤—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞—á—É, —Ç–æ–ª—å–∫–æ —Å–ø–ª–∞–Ω–∏—Ä—É–π

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
- run_bash: –≤—ã–ø–æ–ª–Ω–∏—Ç—å bash-–∫–æ–º–∞–Ω–¥—É
- read_file: –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª
- write_file: –∑–∞–ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–º JSON –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
{
  "goal": "–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏",
  "steps": [
    { "id": 1, "action": "–æ–ø–∏—Å–∞–Ω–∏–µ —à–∞–≥–∞", "tool": "–∏–º—è_tool", "reason": "–∑–∞—á–µ–º" },
    ...
  ]
}`,
            },
            { role: "user", content: userMessage },
        ],
    });

    const planText = planResponse.choices[0].message.content ?? "";

    // –ü–∞—Ä—Å–∏–º –ø–ª–∞–Ω
    let plan: { goal: string; steps: { id: number; action: string; tool: string; reason: string }[] };
    try {
        // –£–±–∏—Ä–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ markdown-–æ–±—ë—Ä—Ç–∫–∏
        const cleanJson = planText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
        plan = JSON.parse(cleanJson);
    } catch (e) {
        console.log("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –ø–ª–∞–Ω:");
        console.log(planText);
        return;
    }

    console.log(`üéØ –¶–µ–ª—å: ${plan.goal}`);
    console.log(`üìù –®–∞–≥–æ–≤: ${plan.steps.length}\n`);
    plan.steps.forEach((s) =&gt; {
        console.log(`   ${s.id}. [${s.tool}] ${s.action}`);
        console.log(`      ‚îî‚îÄ ${s.reason}`);
    });

    // --- –§–ê–ó–ê 2: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (—Å tools) ---
    console.log("\n\n‚ö° –§–ê–ó–ê 2: –í–´–ü–û–õ–ù–ï–ù–ò–ï\n");

    const messages: OpenAI.ChatCompletionMessageParam[] = [
        {
            role: "system",
            content: `–¢—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∑–∞–¥–∞—á. –í—ã–ø–æ–ª–Ω–∏ –ø–ª–∞–Ω –ø–æ—à–∞–≥–æ–≤–æ, –∏—Å–ø–æ–ª—å–∑—É—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.

–ü–õ–ê–ù:
${JSON.stringify(plan, null, 2)}

–í—ã–ø–æ–ª–Ω—è–π —à–∞–≥–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ —Å–æ–æ–±—â–∞–π –ø—Ä–æ–≥—Ä–µ—Å—Å.
–ï—Å–ª–∏ —à–∞–≥ –Ω–µ –ø–æ–ª—É—á–∏–ª—Å—è ‚Äî –∞–¥–∞–ø—Ç–∏—Ä—É–π –ø–ª–∞–Ω.
–ö–æ–≥–¥–∞ –≤—Å–µ —à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚Äî –ø–æ–¥–≤–µ–¥–∏ –∏—Ç–æ–≥.`,
        },
        { role: "user", content: userMessage },
    ];

    let iteration = 0;

    while (iteration &lt; 15) {
        iteration++;
        console.log(`\n--- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: –∏—Ç–µ—Ä–∞—Ü–∏—è ${iteration} ---`);

        const response = await client.chat.completions.create({
            model: MODEL,
            messages,
            tools,
        });

        const message = response.choices[0].message;
        messages.push(message);

        if (!message.tool_calls?.length) {
            console.log("\n‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ.");
            console.log("–ò—Ç–æ–≥:", message.content);
            return;
        }

        for (const toolCall of message.tool_calls) {
            const name = toolCall.function.name;
            const args = JSON.parse(toolCall.function.arguments);
            const argsPreview =
                name === "write_file"
                    ? `{path: "${args.path}", content: [${args.content.length} chars]}`
                    : JSON.stringify(args);

            console.log(`   üîß ${name}(${argsPreview})`);

            const result = toolHandlers[name]?.(args) ?? `Tool "${name}" –Ω–µ –Ω–∞–π–¥–µ–Ω`;
            console.log(`   ‚Üí ${result.slice(0, 120)}`);

            messages.push({
                role: "tool",
                tool_call_id: toolCall.id,
                content: result,
            });
        }
    }
}

// ============================================================
// –ü–û–î–•–û–î 2: ReAct (Reasoning + Acting)
// –î—É–º–∞–µ—Ç –∏ –¥–µ–π—Å—Ç–≤—É–µ—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ —á–µ—Ä–µ–∑ think tool
// ============================================================

async function reactAgent(userMessage: string) {
    console.log("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    console.log("‚ïë   –ü–û–î–•–û–î 2: ReAct (Reason + Act)         ‚ïë");
    console.log("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");

    const messages: OpenAI.ChatCompletionMessageParam[] = [
        {
            role: "system",
            content: `–¢—ã –∞–≥–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á–∏ –ø–æ—à–∞–≥–æ–≤–æ.

–ú–ï–¢–û–î –†–ê–ë–û–¢–´:
1. –ü–µ—Ä–µ–¥ –ö–ê–ñ–î–´–ú –¥–µ–π—Å—Ç–≤–∏–µ–º —Å–Ω–∞—á–∞–ª–∞ –≤—ã–∑–æ–≤–∏ tool "think" ‚Äî –æ–±–¥—É–º–∞–π:
   - –ß—Ç–æ —É–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–æ?
   - –ö–∞–∫–æ–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥?
   - –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç —à–∞–≥?
2. –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω—É–∂–Ω—ã–º tool
3. –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–Ω–æ–≤–∞ "think" ‚Äî –æ—Ü–µ–Ω–∏:
   - –ü–æ–ª—É—á–∏–ª–æ—Å—å –ª–∏?
   - –ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?
   - –ö–∞–∫–æ–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥?

–í–ê–ñ–ù–û: –í—Å–µ–≥–¥–∞ —á–µ—Ä–µ–¥—É–π think ‚Üí action ‚Üí think ‚Üí action.
–ù–µ –¥–µ–ª–∞–π –¥–µ–π—Å—Ç–≤–∏–π –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–¥—É–º—ã–≤–∞–Ω–∏—è.

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: think, run_bash, read_file, write_file.`,
        },
        { role: "user", content: userMessage },
    ];

    let iteration = 0;

    while (iteration &lt; 20) {
        iteration++;

        const response = await client.chat.completions.create({
            model: MODEL,
            messages,
            tools,
        });

        const message = response.choices[0].message;
        messages.push(message);

        if (!message.tool_calls?.length) {
            console.log(`\n‚úÖ –ê–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É (${iteration} –∏—Ç–µ—Ä–∞—Ü–∏–π).`);
            console.log("–û—Ç–≤–µ—Ç:", message.content);
            return;
        }

        for (const toolCall of message.tool_calls) {
            const name = toolCall.function.name;
            const args = JSON.parse(toolCall.function.arguments);

            if (name === "think") {
                // –ö—Ä–∞—Å–∏–≤–æ –≤—ã–≤–æ–¥–∏–º –º—ã—Å–ª–∏ –∞–≥–µ–Ω—Ç–∞
                console.log(`\nüí≠ [–ú—ã—Å–ª—å]: ${args.thought}`);
            } else {
                const argsPreview =
                    name === "write_file"
                        ? `{path: "${args.path}", content: [${args.content.length} chars]}`
                        : JSON.stringify(args);
                console.log(`   üîß ${name}(${argsPreview})`);

                const result = toolHandlers[name]?.(args) ?? `Tool "${name}" –Ω–µ –Ω–∞–π–¥–µ–Ω`;
                console.log(`   ‚Üí ${result.slice(0, 120)}`);

                messages.push({
                    role: "tool",
                    tool_call_id: toolCall.id,
                    content: result,
                });
                continue;
            }

            // Think –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç OK
            messages.push({
                role: "tool",
                tool_call_id: toolCall.id,
                content: "OK",
            });
        }
    }
}

// ============================================================
// MAIN: –≤—ã–±–µ—Ä–∏ –ø–æ–¥—Ö–æ–¥
// ============================================================

async function main() {
    const task =
        "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤—Å–µ .ts —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ src/. " +
        "–ù–∞–π–¥–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏ (–æ–±—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, " +
        "–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∏–º–ø–æ—Ä—Ç—ã, –ø–æ—Ö–æ–∂–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏). " +
        "–°–æ–∑–¥–∞–π —Ñ–∞–π–ª REFACTORING.md —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É.";

    // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π –Ω—É–∂–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
    const approach = process.argv[2] ?? "plan";

    if (approach === "plan") {
        await planThenExecute(task);
    } else if (approach === "react") {
        await reactAgent(task);
    } else {
        console.log("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: npx tsx src/06-planning.ts [plan|react]");
    }
}

main();
</pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>

            <button class="demo-btn" data-demo="demo-step-6">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ</button>

            <div class="terminal-output demo-output" id="demo-step-6" aria-live="polite">

üìã –ü–õ–ê–ù: –ê–Ω–∞–ª–∏–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –≤ –ø–∞–ø–∫–µ src –∏ —Å–æ–∑–¥–∞–Ω–∏–µ REFACTORING.md
  1. [read_file] –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ src/01-basic-call.ts –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞
  2. [read_file] –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ src/02-with-tool.ts –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞
  3. [read_file] –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ src/03-agent-loop.ts –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞
  4. [read_file] –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ src/04-real-tools.ts –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞
  5. [read_file] –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ src/05-skills.ts –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞
  6. [write_file] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª REFACTORING.md —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

‚ö° –í–´–ü–û–õ–ù–ï–ù–ò–ï
  üí≠ –ù–∞—á–∏–Ω–∞–µ–º —Å —á—Ç–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–∑ —Å–ø–∏—Å–∫–∞, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –Ω–∞–π—Ç–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω—ã
  üîß read_file({"path":"src/01-basic-call.ts"})
  ‚Üí // basic call example
export const add = (a:number,b:number)=&gt;a+b;

  üí≠ –ß–∏—Ç–∞–µ–º –≤—Ç–æ—Ä–æ–π —Ñ–∞–π–ª –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –ø–µ—Ä–≤—ã–º –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è –æ–±—â–∏—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
  üîß read_file({"path":"src/02-with-tool.ts"})
  ‚Üí // tool example
export const tool = () =&gt; "ok";

  üí≠ –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ—Ç—å–µ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
  üîß read_file({"path":"src/03-agent-loop.ts"})
  ‚Üí // agent loop example
export const loop = () =&gt; true;

  üí≠ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —á–µ—Ç–≤–µ—Ä—Ç—ã–π —Ñ–∞–π–ª –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
  üîß read_file({"path":"src/04-real-tools.ts"})
  ‚Üí // real tools example
export const run = () =&gt; null;

  üí≠ –ß–∏—Ç–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ñ–∞–π–ª –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ src
  üîß read_file({"path":"src/05-skills.ts"})
  ‚Üí // skills example
export const skill = {};

  üí≠ –ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å–æ—Å—Ç–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç —Å –≤—ã—è–≤–ª–µ–Ω–Ω—ã–º–∏ –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏ –∫–æ–¥–∞, –æ–±—â–∏–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –ø–æ –∏—Ö —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é —á–µ—Ä–µ–∑ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –æ–±—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π/—É—Ç–∏–ª–∏—Ç
  üîß write_file({"path":"REFACTORING.md","content":"# REFACTORING

(–ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—ã–≤–æ–¥—ã –ø–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é –∫–æ–¥–∞)
"})
  ‚Üí OK: –∑–∞–ø–∏—Å–∞–Ω REFACTORING.md
</div>
            <div class="output-note" data-demo-note="demo-step-6">–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞. –£ —Ç–µ–±—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–∞—á–µ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.</div>

            <div class="run-command">
                <span class="run-icon">‚ñ∂</span>
                <code>npx tsx src/06-planning.ts plan &nbsp;# –∏–ª–∏ "react"</code>
            </div>

            <div class="mini-block expect">
                <div class="mini-title">‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è</div>
                –ê–≥–µ–Ω—Ç —Å–Ω–∞—á–∞–ª–∞ –ø–µ—á–∞—Ç–∞–µ—Ç –ø–ª–∞–Ω, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç —à–∞–≥–∏. –í —Ä–µ–∂–∏–º–µ <code>react</code> –≤–∏–¥–Ω—ã –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ ¬´–º—ã—Å–ª–∏¬ª.
            </div>

            <div class="mini-block trouble">
                <div class="mini-title">üßØ –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º <code>plan</code> –∏–ª–∏ <code>react</code> –∏ —á—Ç–æ tool <code>think</code> –ø–æ–¥–∫–ª—é—á—ë–Ω.
            </div>

            <div class="key-insight">
                <strong>üí° <span class="term" data-tip="–°–Ω–∞—á–∞–ª–∞ –ø–ª–∞–Ω, –ø–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ —à–∞–≥–∞–º">Plan-then-Execute</span></strong> ‚Äî –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ, –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞–Ω —é–∑–µ—Ä—É. –ú–∏–Ω—É—Å: –ø–ª–∞–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ç–æ—á–Ω—ã–º.
                <br><strong>üí° <span class="term" data-tip="–ß–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –∏ –¥–µ–π—Å—Ç–≤–∏–π">ReAct</span></strong> ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω–æ, –∞–≥–µ–Ω—Ç –≤–∏–¥–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ú–∏–Ω—É—Å: –º–µ–Ω–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ, –±–æ–ª—å—à–µ –∏—Ç–µ—Ä–∞—Ü–∏–π.
            </div>
        </div>
    </div>
</div>

<!-- ======== STEP 7 ======== -->
<div class="step" data-step="7" id="step-7">
    <div class="step-number">07</div>
    <div class="step-card">
        <div class="step-header">
            <div class="step-title">Adaptive Agent ‚Äî Plan + <span class="term" data-tip="–ß–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –∏ –¥–µ–π—Å—Ç–≤–∏–π">ReAct</span> + Replan</div>
            <span class="step-badge advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</span>
        </div>
        <p class="step-intro">
            –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ–±–∞ –ø–æ–¥—Ö–æ–¥–∞: –∞–≥–µ–Ω—Ç –ø–ª–∞–Ω–∏—Ä—É–µ—Ç, –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è–º–∏, –∏ –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–ª–∞–Ω –µ—Å–ª–∏ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Å–æ–≤–ø–∞–ª–∞ —Å –æ–∂–∏–¥–∞–Ω–∏—è–º–∏.
        </p>

        <div class="step-content">
            <div class="arch-diagram">
                <div class="loop-flow">
                    <span class="loop-node llm">Plan</span>
                    <span class="loop-arrow">‚Üí</span>
                    <span class="loop-node output">ReAct Execute</span>
                    <span class="loop-arrow">‚Üí</span>
                    <span class="loop-node tool">Replan?</span>
                    <span class="loop-arrow">‚Üí</span>
                    <span class="loop-node context">Execute</span>
                    <span class="loop-arrow">‚Üí</span>
                    <span class="loop-node llm">Done</span>
                </div>
            </div>

            <div class="step-detail">
                <p>–ö–ª—é—á–µ–≤–∞—è –Ω–æ–≤–∏–Ω–∫–∞ ‚Äî <code>request_replan</code> <span class="term" data-tip="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç/—Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª—å">tool</span>. –ê–≥–µ–Ω—Ç —Å–∞–º —Ä–µ—à–∞–µ—Ç –∫–æ–≥–¥–∞ –ø–ª–∞–Ω —Å–ª–æ–º–∞–ª—Å—è –Ω–∞—Å—Ç–æ–ª—å–∫–æ, —á—Ç–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–æ—Å–º—ã—Å–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é.</p>
            </div>

            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>request_replan tool</div>
                <pre>{
    <span class="prop">name</span>: <span class="str">"request_replan"</span>,
    <span class="prop">description</span>: <span class="str">"–í—ã–∑–æ–≤–∏ –∫–æ–≥–¥–∞ –ø–ª–∞–Ω –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å"</span>,
    <span class="prop">parameters</span>: {
        <span class="prop">reason</span>: <span class="str">"–ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω –Ω–æ–≤—ã–π –ø–ª–∞–Ω"</span>,
        <span class="prop">completed_steps</span>: [<span class="str">"–ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ"</span>],
        <span class="prop">discoveries</span>: [<span class="str">"–ß—Ç–æ –Ω–æ–≤–æ–≥–æ —É–∑–Ω–∞–ª–∏"</span>],
    }
}

<span class="cm">// –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª:</span>
<span class="kw">while</span> (replanCount &lt;= MAX_REPLANS) {
    <span class="kw">const</span> result = <span class="kw">await</span> <span class="fn">executeWithReact</span>(task, plan);
    <span class="kw">if</span> (result.status === <span class="str">"completed"</span>) <span class="kw">return</span>;

    <span class="cm">// –†–µ–ø–ª–∞–Ω —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Ç–æ–≥–æ, —á—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ</span>
    plan = <span class="kw">await</span> <span class="fn">createPlan</span>(task, {
        <span class="prop">previousPlan</span>: plan,
        <span class="prop">completedSteps</span>: result.replanContext.completedSteps,
        <span class="prop">discoveries</span>: result.replanContext.discoveries,
    });
}</pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>
            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>src/07-adaptive-agent.ts</div>
                <pre>// src/07-adaptive-agent.ts
// –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∞–≥–µ–Ω—Ç: Plan ‚Üí ReAct Execute ‚Üí Replan –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
import OpenAI from "openai";
import { execSync } from "child_process";
import { readFileSync, writeFileSync } from "fs";
import dotenv from "dotenv";

dotenv.config();

const client = new OpenAI({
    baseURL: "https://openrouter.ai/api/v1",
    apiKey: process.env.OPENROUTER_API_KEY ?? "",
});

const MODEL = "anthropic/claude-sonnet-4.5";

// ============================================================
// TOOLS
// ============================================================

const executionTools: OpenAI.ChatCompletionTool[] = [
    {
        type: "function",
        function: {
            name: "think",
            description:
                "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–ª–æ–∫–Ω–æ—Ç. –ò—Å–ø–æ–ª—å–∑—É–π –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º —á—Ç–æ–±—ã –æ–±–¥—É–º–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥, " +
                "–∏ –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.",
            parameters: {
                type: "object",
                properties: {
                    thought: { type: "string", description: "–†–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ" },
                },
                required: ["thought"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "run_bash",
            description: "–í—ã–ø–æ–ª–Ω–∏—Ç—å bash-–∫–æ–º–∞–Ω–¥—É",
            parameters: {
                type: "object",
                properties: {
                    command: { type: "string", description: "–ö–æ–º–∞–Ω–¥–∞" },
                },
                required: ["command"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "read_file",
            description: "–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª",
            parameters: {
                type: "object",
                properties: {
                    path: { type: "string", description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É" },
                },
                required: ["path"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "write_file",
            description: "–ó–∞–ø–∏—Å–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ —Ñ–∞–π–ª",
            parameters: {
                type: "object",
                properties: {
                    path: { type: "string", description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É" },
                    content: { type: "string", description: "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ" },
                },
                required: ["path", "content"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "request_replan",
            description:
                "–í—ã–∑–æ–≤–∏ –∫–æ–≥–¥–∞ –ø–ª–∞–Ω –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å: –æ–±–Ω–∞—Ä—É–∂–∏–ª–∞—Å—å –Ω–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, " +
                "—à–∞–≥ –ø—Ä–æ–≤–∞–ª–∏–ª—Å—è, –∏–ª–∏ –ø–æ—è–≤–∏–ª—Å—è –ª—É—á—à–∏–π –ø—É—Ç—å –∫ —Ü–µ–ª–∏.",
            parameters: {
                type: "object",
                properties: {
                    reason: { type: "string", description: "–ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω –Ω–æ–≤—ã–π –ø–ª–∞–Ω" },
                    completed_steps: {
                        type: "array",
                        items: { type: "string" },
                        description: "–ö–∞–∫–∏–µ —à–∞–≥–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã",
                    },
                    discoveries: {
                        type: "array",
                        items: { type: "string" },
                        description: "–ß—Ç–æ –Ω–æ–≤–æ–≥–æ —É–∑–Ω–∞–ª–∏",
                    },
                },
                required: ["reason", "completed_steps", "discoveries"],
            },
        },
    },
];

const toolHandlers: Record&lt;string, (args: any) =&gt; string&gt; = {
    think: () =&gt; "OK",
    run_bash: ({ command }) =&gt; {
        try {
            return execSync(command, { encoding: "utf-8", timeout: 10000 }).trim();
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.stderr || e.message}`;
        }
    },
    read_file: ({ path }) =&gt; {
        try {
            return readFileSync(path, "utf-8");
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.message}`;
        }
    },
    write_file: ({ path, content }) =&gt; {
        try {
            writeFileSync(path, content, "utf-8");
            return `‚úÖ –§–∞–π–ª ${path} –∑–∞–ø–∏—Å–∞–Ω (${content.length} –±–∞–π—Ç)`;
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.message}`;
        }
    },
    request_replan: () =&gt; "REPLAN_REQUESTED",
};

// ============================================================
// –§–ê–ó–ê 1: –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–ï
// ============================================================

interface Plan {
    goal: string;
    steps: { id: number; action: string; tool: string; reason: string }[];
}

async function createPlan(
    task: string,
    context?: { previousPlan?: Plan; completedSteps?: string[]; discoveries?: string[] }
): Promise&lt;Plan&gt; {
    let systemPrompt = `–¢—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫. –°–æ—Å—Ç–∞–≤—å –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: run_bash, read_file, write_file.

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–º JSON:
{
  "goal": "–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏",
  "steps": [
    { "id": 1, "action": "–æ–ø–∏—Å–∞–Ω–∏–µ", "tool": "–∏–º—è_tool", "reason": "–∑–∞—á–µ–º" }
  ]
}`;

    // –ï—Å–ª–∏ —ç—Ç–æ —Ä–µ–ø–ª–∞–Ω ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
    if (context?.previousPlan) {
        systemPrompt += `

–ö–û–ù–¢–ï–ö–°–¢ –†–ï–ü–õ–ê–ù–ê:
–ü—Ä–µ–¥—ã–¥—É—â–∏–π –ø–ª–∞–Ω: ${JSON.stringify(context.previousPlan)}
–£–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: ${context.completedSteps?.join(", ") || "–Ω–∏—á–µ–≥–æ"}
–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: ${context.discoveries?.join("; ") || "–Ω–µ—Ç"}

–£—á—Ç–∏ —á—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ, –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏.
–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π –ø–ª–∞–Ω —Å —É—á—ë—Ç–æ–º –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.`;
    }

    const response = await client.chat.completions.create({
        model: MODEL,
        messages: [
            { role: "system", content: systemPrompt },
            { role: "user", content: task },
        ],
    });

    const text = response.choices[0].message.content ?? "";
    const cleanJson = text.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
    return JSON.parse(cleanJson);
}

function printPlan(plan: Plan, isReplan: boolean = false) {
    const label = isReplan ? "üîÑ –ù–û–í–´–ô –ü–õ–ê–ù" : "üìã –ü–õ–ê–ù";
    console.log(`\n${label}: ${plan.goal}`);
    console.log("‚îÄ".repeat(50));
    plan.steps.forEach((s) =&gt; {
        console.log(`  ${s.id}. [${s.tool}] ${s.action}`);
        console.log(`     ‚îî‚îÄ ${s.reason}`);
    });
    console.log("‚îÄ".repeat(50));
}

// ============================================================
// –§–ê–ó–ê 2: –í–´–ü–û–õ–ù–ï–ù–ò–ï —Å ReAct + –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–ø–ª–∞–Ω–∞
// ============================================================

interface ExecutionResult {
    status: "completed" | "replan_requested";
    replanContext?: {
        reason: string;
        completedSteps: string[];
        discoveries: string[];
    };
}

async function executeWithReact(
    task: string,
    plan: Plan
): Promise&lt;ExecutionResult&gt; {
    const messages: OpenAI.ChatCompletionMessageParam[] = [
        {
            role: "system",
            content: `–¢—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å —Å –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–º –º—ã—à–ª–µ–Ω–∏–µ–º.

–¢–í–û–ô –ü–õ–ê–ù:
${JSON.stringify(plan, null, 2)}

–ú–ï–¢–û–î –†–ê–ë–û–¢–´:
1. –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º ‚Äî –≤—ã–∑–æ–≤–∏ "think": –æ–±–¥—É–º–∞–π —à–∞–≥, –ø—Ä–æ–≤–µ—Ä—å —á—Ç–æ –æ–Ω –≤—Å—ë –µ—â—ë –∞–∫—Ç—É–∞–ª–µ–Ω
2. –í—ã–ø–æ–ª–Ω–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω—É–∂–Ω—ã–º tool
3. –ü–æ—Å–ª–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Äî —Å–Ω–æ–≤–∞ "think": –æ—Ü–µ–Ω–∏, —Å–æ–≤–ø–∞–ª–æ –ª–∏ —Å –æ–∂–∏–¥–∞–Ω–∏—è–º–∏
4. –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª —á—Ç–æ –ø–ª–∞–Ω –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å ‚Äî –≤—ã–∑–æ–≤–∏ "request_replan"

–ö–û–ì–î–ê –í–´–ó–´–í–ê–¢–¨ request_replan:
- –û–±–Ω–∞—Ä—É–∂–∏–ª —á—Ç–æ-—Ç–æ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ (—Ñ–∞–π–ª–æ–≤ –±–æ–ª—å—à–µ/–º–µ–Ω—å—à–µ —á–µ–º –¥—É–º–∞–ª–∏)
- –®–∞–≥ –ø—Ä–æ–≤–∞–ª–∏–ª—Å—è –∏ –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å —Ç—Ä–µ–±—É–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞
- –ü–æ—è–≤–∏–ª–∞—Å—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —à–∞–≥–∏ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏
- –ù–∞—à—ë–ª –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å –∫ —Ü–µ–ª–∏

–ù–ï –≤—ã–∑—ã–≤–∞–π replan –¥–ª—è –º–µ–ª–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º ‚Äî –∞–¥–∞–ø—Ç–∏—Ä—É–π—Å—è –Ω–∞ –ª–µ—Ç—É.
–í—ã–∑—ã–≤–∞–π —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –∫—É—Ä—Å–∞.`,
        },
        { role: "user", content: task },
    ];

    let iteration = 0;

    while (iteration &lt; 20) {
        iteration++;

        const response = await client.chat.completions.create({
            model: MODEL,
            messages,
            tools: executionTools,
        });

        const message = response.choices[0].message;
        messages.push(message);

        if (!message.tool_calls?.length) {
            console.log(`\n‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ (${iteration} –∏—Ç–µ—Ä–∞—Ü–∏–π)`);
            console.log("–ò—Ç–æ–≥:", message.content?.slice(0, 300));
            return { status: "completed" };
        }

        for (const toolCall of message.tool_calls) {
            const name = toolCall.function.name;
            const args = JSON.parse(toolCall.function.arguments);

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥
            if (name === "think") {
                console.log(`\n  üí≠ ${args.thought}`);
            } else if (name === "request_replan") {
                console.log(`\n  üîÑ –†–ï–ü–õ–ê–ù: ${args.reason}`);
                messages.push({
                    role: "tool",
                    tool_call_id: toolCall.id,
                    content: "REPLAN_REQUESTED",
                });
                return {
                    status: "replan_requested",
                    replanContext: {
                        reason: args.reason,
                        completedSteps: args.completed_steps,
                        discoveries: args.discoveries,
                    },
                };
            } else {
                const argsPreview =
                    name === "write_file"
                        ? `{path: "${args.path}", content: [${args.content.length} chars]}`
                        : JSON.stringify(args);
                console.log(`  üîß ${name}(${argsPreview})`);

                const result = toolHandlers[name]?.(args) ?? `Tool "${name}" –Ω–µ –Ω–∞–π–¥–µ–Ω`;
                console.log(`     ‚Üí ${result.slice(0, 120)}`);
            }

            messages.push({
                role: "tool",
                tool_call_id: toolCall.id,
                content: toolHandlers[name]?.(args) ?? "OK",
            });
        }
    }

    return { status: "completed" };
}

// ============================================================
// –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ: Plan ‚Üí Execute ‚Üí Replan ‚Üí Execute ‚Üí ...
// ============================================================

async function adaptiveAgent(task: string) {
    console.log("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    console.log("‚ïë   ADAPTIVE AGENT: Plan + ReAct + Replan      ‚ïë");
    console.log("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
    console.log(`\nüìå –ó–∞–¥–∞—á–∞: ${task}\n`);

    let plan = await createPlan(task);
    printPlan(plan);

    const MAX_REPLANS = 3;
    let replanCount = 0;

    while (replanCount &lt;= MAX_REPLANS) {
        console.log(`\n‚ö° –í–´–ü–û–õ–ù–ï–ù–ò–ï (–ø–ª–∞–Ω v${replanCount + 1})\n`);

        const result = await executeWithReact(task, plan);

        if (result.status === "completed") {
            console.log("\nüéâ –ê–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∏–ª –∑–∞–¥–∞—á—É.");
            return;
        }

        // –†–µ–ø–ª–∞–Ω
        replanCount++;
        if (replanCount &gt; MAX_REPLANS) {
            console.log("\n‚ö†Ô∏è  –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Ä–µ–ø–ª–∞–Ω–æ–≤. –ó–∞–≤–µ—Ä—à–∞–µ–º —Å —Ç–µ–∫—É—â–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.");
            return;
        }

        console.log(`\nüìã –†–ï–ü–õ–ê–ù #${replanCount}...`);
        plan = await createPlan(task, {
            previousPlan: plan,
            completedSteps: result.replanContext?.completedSteps,
            discoveries: result.replanContext?.discoveries,
        });
        printPlan(plan, true);
    }
}

// ============================================================
// –ó–ê–ü–£–°–ö
// ============================================================

const task =
    process.argv[2] ||
    "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤—Å–µ .ts —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ src/. " +
    "–ù–∞–π–¥–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏ (–æ–±—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, " +
    "–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∏–º–ø–æ—Ä—Ç—ã, –ø–æ—Ö–æ–∂–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏). " +
    "–°–æ–∑–¥–∞–π —Ñ–∞–π–ª REFACTORING.md —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.";

adaptiveAgent(task);
</pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>

            <div class="run-command">
                <span class="run-icon">‚ñ∂</span>
                <code>npx tsx src/07-adaptive-agent.ts</code>
            </div>

            <button class="demo-btn" data-demo="demo-step-7">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ</button>

            <div class="terminal-output demo-output" id="demo-step-7" aria-live="polite">

üìã –ü–õ–ê–ù 1
  1. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
  2. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
  3. –ù–∞–π—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
  4. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –æ—Ç—á—ë—Ç–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–µ–∫—Ç–∞

üîß list_dir({"path":"."})
‚Üí README.md
package.json
services
src

üîß request_replan({"reason":"–ù–∞–π–¥–µ–Ω—ã –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ","completed_steps":["–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏"],"discoveries":["–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–∞–ø–∫–∞ services/"]})

üìã –ü–õ–ê–ù 2
  1. –ò–∑—É—á–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ services/ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–µ—Ä–≤–∏—Å–æ–≤
  2. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
  3. –ù–∞–π—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
  4. –°–æ–∑–¥–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–µ–∫—Ç–∞

üîß list_dir({"path":"services"})
‚Üí index.ts

üîß read_file({"path":"README.md"})
‚Üí # simple-agent

–£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ AI-–∞–≥–µ–Ω—Ç–∞.


–ì–æ—Ç–æ–≤–æ!
</div>
            <div class="output-note" data-demo-note="demo-step-7">–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞. –£ —Ç–µ–±—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–∞—á–µ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.</div>

            <div class="mini-block expect">
                <div class="mini-title">‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è</div>
                –í–∏–¥–Ω–æ, —á—Ç–æ –∞–≥–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ –Ω–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ—Ç—Å—è: –µ—Å—Ç—å –ª–∏–º–∏—Ç –Ω–∞ —Ä–µ–ø–ª–∞–Ω.
            </div>

            <div class="mini-block trouble">
                <div class="mini-title">üßØ –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ <code>request_replan</code> –æ–±—ä—è–≤–ª–µ–Ω –∫–∞–∫ tool –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Ü–∏–∫–ª–µ.
            </div>

            <div class="key-insight">
                <strong>üí° –≠—Ç–æ –æ—Ç–ª–∏—á–∞–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –æ—Ç —Ç—É–ø–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è:</strong>
                –æ–Ω –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω, –Ω–æ –∏ –Ω–µ –±—É–¥–µ—Ç —Ä–µ–ø–ª—ç–Ω–∏—Ç—å –Ω–∞ –∫–∞–∂–¥—ã–π —á–∏—Ö.
                –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–∏ —Ä–µ–ø–ª–∞–Ω–µ –∑–Ω–∞–µ—Ç: —á—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ, —á—Ç–æ –Ω–æ–≤–æ–≥–æ —É–∑–Ω–∞–ª–∏, –ø–æ—á–µ–º—É —Å—Ç–∞—Ä—ã–π –ø–ª–∞–Ω –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç.
            </div>
        </div>
    </div>
</div>

<!-- ======== STEP 8 ======== -->
<div class="step" data-step="8" id="step-8">
    <div class="step-number">08</div>
    <div class="step-card">
        <div class="step-header">
        <div class="step-title"><span class="term" data-tip="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π">Human-in-the-Loop</span> + <span class="term" data-tip="–ü–æ—à–∞–≥–æ–≤—ã–π –º–∞—Å—Ç–µ—Ä/–≤–∏–∑–∞—Ä–¥">Wizard</span></div>
            <span class="step-badge advanced">–§–∏–Ω–∞–ª</span>
        </div>
        <p class="step-intro">
            –ê–≥–µ–Ω—Ç —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫–æ–º, –Ω–æ —á–µ–ª–æ–≤–µ–∫ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è. –¢—Ä–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö tool'–∞ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç –∞–≥–µ–Ω—Ç –≤ —É–º–Ω–æ–≥–æ –ø–æ–º–æ—â–Ω–∏–∫–∞-–≤–∏–∑–∞—Ä–¥–∞.
        </p>

        <div class="step-content">
            <div class="step-detail">
                <p>–î–≤–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –≤ –æ–¥–Ω–æ–º:</p>
                <p>
                    <strong>Human-in-the-loop</strong> ‚Äî –∞–≥–µ–Ω—Ç –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ–ø–∞—Å–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ (–∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤).
                </p>
                <p>
                    <strong><span class="term" data-tip="–ü–æ—à–∞–≥–æ–≤—ã–π –º–∞—Å—Ç–µ—Ä/–≤–∏–∑–∞—Ä–¥">Wizard/Guide</span></strong> ‚Äî –∞–≥–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã, –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—ã–±–æ—Ä, –∏ —Ç–∞–∫ –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤.
                </p>
            </div>

            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>–¢—Ä–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö tool'–∞</div>
                <pre><span class="cm">// –ú–æ–¥–µ–ª—å —Å–∞–º–∞ —Ä–µ—à–∞–µ—Ç –∫–∞–∫–æ–π —Ç–∏–ø –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –Ω—É–∂–µ–Ω:</span>

<span class="cm">// 1. –í—ã–±–æ—Ä –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (wizard-—Å—Ç–∏–ª—å)</span>
{
    <span class="prop">name</span>: <span class="str">"ask_user_choice"</span>,
    <span class="prop">description</span>: <span class="str">"–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±–æ—Ä –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤"</span>,
    <span class="prop">parameters</span>: {
        <span class="prop">question</span>: <span class="str">"–û–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏"</span>,
        <span class="prop">options</span>: [
            { <span class="prop">label</span>: <span class="str">"–í–∞—Ä–∏–∞–Ω—Ç A"</span>, <span class="prop">description</span>: <span class="str">"–ü–ª—é—Å—ã, –º–∏–Ω—É—Å—ã"</span> },
            { <span class="prop">label</span>: <span class="str">"–í–∞—Ä–∏–∞–Ω—Ç B"</span>, <span class="prop">description</span>: <span class="str">"–ü–ª—é—Å—ã, –º–∏–Ω—É—Å—ã"</span> },
        ],
        <span class="prop">allow_custom</span>: <span class="num">true</span>
    }
}

<span class="cm">// 2. –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥</span>
{ <span class="prop">name</span>: <span class="str">"ask_user_input"</span> }    <span class="cm">// "–ö–∞–∫ –Ω–∞–∑–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç?"</span>

<span class="cm">// 3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–∞/–Ω–µ—Ç</span>
{ <span class="prop">name</span>: <span class="str">"ask_user_confirm"</span> }  <span class="cm">// "–ó–∞–ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª?"</span></pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>
            <div class="code-block">
                <div class="code-filename"><span class="dot"></span>src/08-interactive-agent.ts</div>
                <pre>// src/08-interactive-agent.ts
// –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∞–≥–µ–Ω—Ç: Human-in-the-loop + Wizard-style guided flow
import OpenAI from "openai";
import { execSync } from "child_process";
import { readFileSync, writeFileSync, existsSync } from "fs";
import * as readline from "readline";
import dotenv from "dotenv";

dotenv.config();

const client = new OpenAI({
    baseURL: "https://openrouter.ai/api/v1",
    apiKey: process.env.OPENROUTER_API_KEY ?? "",
});

const MODEL = "anthropic/claude-sonnet-4.5";

// ============================================================
// –£–¢–ò–õ–ò–¢–ê: –≤–≤–æ–¥ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
// ============================================================

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
});

function ask(question: string): Promise&lt;string&gt; {
    return new Promise((resolve) =&gt; {
        rl.question(question, (answer) =&gt; resolve(answer.trim()));
    });
}

// ============================================================
// TOOLS: –≤–∫–ª—é—á–∞—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ
// ============================================================

const tools: OpenAI.ChatCompletionTool[] = [
    {
        type: "function",
        function: {
            name: "think",
            description: "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–ª–æ–∫–Ω–æ—Ç –¥–ª—è —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π.",
            parameters: {
                type: "object",
                properties: {
                    thought: { type: "string", description: "–†–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ" },
                },
                required: ["thought"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "run_bash",
            description: "–í—ã–ø–æ–ª–Ω–∏—Ç—å bash-–∫–æ–º–∞–Ω–¥—É (read-only, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ)",
            parameters: {
                type: "object",
                properties: {
                    command: { type: "string", description: "–ö–æ–º–∞–Ω–¥–∞" },
                },
                required: ["command"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "read_file",
            description: "–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª",
            parameters: {
                type: "object",
                properties: {
                    path: { type: "string", description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É" },
                },
                required: ["path"],
            },
        },
    },
    // --- –û–ü–ê–°–ù–û–ï –î–ï–ô–°–¢–í–ò–ï: —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ---
    {
        type: "function",
        function: {
            name: "write_file",
            description:
                "–ó–∞–ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª. –í–ê–ñ–ù–û: —ç—Ç–æ –∏–∑–º–µ–Ω—è—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ ‚Äî " +
                "–±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.",
            parameters: {
                type: "object",
                properties: {
                    path: { type: "string", description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É" },
                    content: { type: "string", description: "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ" },
                },
                required: ["path", "content"],
            },
        },
    },
    // --- WIZARD: –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ---
    {
        type: "function",
        function: {
            name: "ask_user_choice",
            description:
                "–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±–æ—Ä –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤. " +
                "–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–∏—Ö —Ä–µ—à–µ–Ω–∏–π –∏ –≤—ã–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. " +
                "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –Ω–æ–º–µ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏–ª–∏ –≤–≤–µ—Å—Ç–∏ —Å–≤–æ–π.",
            parameters: {
                type: "object",
                properties: {
                    question: {
                        type: "string",
                        description: "–í–æ–ø—Ä–æ—Å –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
                    },
                    options: {
                        type: "array",
                        items: {
                            type: "object",
                            properties: {
                                label: { type: "string", description: "–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞" },
                                description: { type: "string", description: "–û–ø–∏—Å–∞–Ω–∏–µ ‚Äî –ø–ª—é—Å—ã, –º–∏–Ω—É—Å—ã, –¥–ª—è –∫–æ–≥–æ" },
                            },
                            required: ["label", "description"],
                        },
                        description: "–í–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ (2-5 —à—Ç—É–∫)",
                    },
                    allow_custom: {
                        type: "boolean",
                        description: "–†–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–≤–µ—Å—Ç–∏ —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç",
                    },
                },
                required: ["question", "options"],
            },
        },
    },
    // --- WIZARD: –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ ---
    {
        type: "function",
        function: {
            name: "ask_user_input",
            description:
                "–ó–∞–ø—Ä–æ—Å–∏—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥. " +
                "–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: –∏–º—è, –ø—É—Ç—å, –æ–ø–∏—Å–∞–Ω–∏–µ.",
            parameters: {
                type: "object",
                properties: {
                    question: { type: "string", description: "–ß—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç—å" },
                    hint: { type: "string", description: "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –∏–ª–∏ –ø—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞" },
                    default_value: { type: "string", description: "–ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (Enter —á—Ç–æ–±—ã –ø—Ä–∏–Ω—è—Ç—å)" },
                },
                required: ["question"],
            },
        },
    },
    // --- WIZARD: –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–∞/–Ω–µ—Ç ---
    {
        type: "function",
        function: {
            name: "ask_user_confirm",
            description:
                "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–∞/–Ω–µ—Ç. " +
                "–ò—Å–ø–æ–ª—å–∑—É–π –ø–µ—Ä–µ–¥ –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã–º–∏ –∏–ª–∏ –≤–∞–∂–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏.",
            parameters: {
                type: "object",
                properties: {
                    question: { type: "string", description: "–ß—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" },
                    details: { type: "string", description: "–î–µ—Ç–∞–ª–∏ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è" },
                },
                required: ["question"],
            },
        },
    },
];

// ============================================================
// TOOL HANDLERS (—Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é)
// ============================================================

// –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è human-in-the-loop
const DANGEROUS_TOOLS = new Set(["write_file"]);

const toolHandlers: Record&lt;string, (args: any) =&gt; Promise&lt;string&gt; | string&gt; = {
    think: () =&gt; "OK",

    run_bash: ({ command }) =&gt; {
        try {
            return execSync(command, { encoding: "utf-8", timeout: 10000 }).trim();
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.stderr || e.message}`;
        }
    },

    read_file: ({ path }) =&gt; {
        try {
            return readFileSync(path, "utf-8");
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.message}`;
        }
    },

    // --- HUMAN-IN-THE-LOOP: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é ---
    write_file: async ({ path, content }) =&gt; {
        const exists = existsSync(path);
        const action = exists ? "–ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å" : "—Å–æ–∑–¥–∞—Ç—å";

        console.log("\n" + "‚ïê".repeat(50));
        console.log(`‚ö†Ô∏è  –ê–≥–µ–Ω—Ç —Ö–æ—á–µ—Ç ${action} —Ñ–∞–π–ª: ${path}`);
        console.log("‚îÄ".repeat(50));

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
        const lines = content.split("\n");
        const preview = lines.slice(0, 15).join("\n");
        console.log(preview);
        if (lines.length &gt; 15) {
            console.log(`... (–µ—â—ë ${lines.length - 15} —Å—Ç—Ä–æ–∫)`);
        }
        console.log("‚îÄ".repeat(50));

        const answer = await ask(`–†–∞–∑—Ä–µ—à–∏—Ç—å? [y/n/edit]: `);

        if (answer.toLowerCase() === "y" || answer.toLowerCase() === "–¥") {
            try {
                writeFileSync(path, content, "utf-8");
                return `‚úÖ –§–∞–π–ª ${path} –∑–∞–ø–∏—Å–∞–Ω (–æ–¥–æ–±—Ä–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)`;
            } catch (e: any) {
                return `–û—à–∏–±–∫–∞: ${e.message}`;
            }
        } else if (answer.toLowerCase() === "edit" || answer.toLowerCase() === "e") {
            const newPath = await ask(`–ù–æ–≤—ã–π –ø—É—Ç—å (Enter = ${path}): `);
            const finalPath = newPath || path;
            try {
                writeFileSync(finalPath, content, "utf-8");
                return `‚úÖ –§–∞–π–ª ${finalPath} –∑–∞–ø–∏—Å–∞–Ω (–ø—É—Ç—å –∏–∑–º–µ–Ω—ë–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)`;
            } catch (e: any) {
                return `–û—à–∏–±–∫–∞: ${e.message}`;
            }
        } else {
            return `‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞ ${path}`;
        }
    },

    // --- WIZARD: –≤—ã–±–æ—Ä –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ---
    ask_user_choice: async ({ question, options, allow_custom }) =&gt; {
        console.log("\n" + "‚ïê".repeat(50));
        console.log(`ü§î ${question}`);
        console.log("‚îÄ".repeat(50));

        options.forEach((opt: any, i: number) =&gt; {
            console.log(`  ${i + 1}) ${opt.label}`);
            console.log(`     ${opt.description}`);
        });

        if (allow_custom) {
            console.log(`  ${options.length + 1}) –°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç...`);
        }

        console.log("‚îÄ".repeat(50));
        const answer = await ask(`–í—ã–±–æ—Ä [1-${options.length + (allow_custom ? 1 : 0)}]: `);

        const num = parseInt(answer);

        if (allow_custom &amp;&amp; num === options.length + 1) {
            const custom = await ask("–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç: ");
            return `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç: "${custom}"`;
        }

        if (num &gt;= 1 &amp;&amp; num &lt;= options.length) {
            const chosen = options[num - 1];
            return `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª: "${chosen.label}" ‚Äî ${chosen.description}`;
        }

        // –ï—Å–ª–∏ –≤–≤–µ–ª–∏ —Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ –Ω–æ–º–µ—Ä–∞
        return `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—Ç–∏–ª: "${answer}"`;
    },

    // --- WIZARD: —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ ---
    ask_user_input: async ({ question, hint, default_value }) =&gt; {
        console.log("\n" + "‚ïê".repeat(50));
        let prompt = `üìù ${question}`;
        if (hint) prompt += `\n   üí° ${hint}`;
        if (default_value) prompt += `\n   (Enter = "${default_value}")`;
        console.log(prompt);
        console.log("‚îÄ".repeat(50));

        const answer = await ask("&gt; ");
        const result = answer || default_value || "";
        return `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª: "${result}"`;
    },

    // --- WIZARD: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ---
    ask_user_confirm: async ({ question, details }) =&gt; {
        console.log("\n" + "‚ïê".repeat(50));
        console.log(`‚ùì ${question}`);
        if (details) console.log(`   ${details}`);
        console.log("‚îÄ".repeat(50));

        const answer = await ask("–î–∞/–ù–µ—Ç [y/n]: ");
        const confirmed = ["y", "–¥", "–¥–∞", "yes"].includes(answer.toLowerCase());
        return confirmed ? "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª: –î–ê" : "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª: –ù–ï–¢";
    },
};

// ============================================================
// AGENT LOOP (—Å async handlers)
// ============================================================

async function interactiveAgent(task: string, systemPrompt?: string) {
    const defaultSystem = `–¢—ã —É–º–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç-–≤–∏–∑–∞—Ä–¥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏.

–°–¢–ò–õ–¨ –†–ê–ë–û–¢–´:
1. –°–Ω–∞—á–∞–ª–∞ —Ä–∞–∑–±–µ—Ä–∏—Å—å –≤ —Å–∏—Ç—É–∞—Ü–∏–∏ (read_file, run_bash, think)
2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏ –ø–æ–¥–≥–æ—Ç–æ–≤—å –≤–∞—Ä–∏–∞–Ω—Ç—ã
3. –ü—Ä–µ–¥–ª–æ–∂–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±–æ—Ä —á–µ—Ä–µ–∑ ask_user_choice
4. –ù–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±–æ—Ä–∞ ‚Äî –¥–µ–π—Å—Ç–≤—É–π –∏–ª–∏ —É—Ç–æ—á–Ω–∏ –¥–µ—Ç–∞–ª–∏ —á–µ—Ä–µ–∑ ask_user_input
5. –ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω—è—é—â–∏–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–¥–∏ —á–µ—Ä–µ–∑ ask_user_confirm –∏–ª–∏ write_file

–ü–†–ò–ù–¶–ò–ü–´:
- –ù–µ –¥–µ–ª–∞–π –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π ‚Äî —Å–ø—Ä–∞—à–∏–≤–∞–π
- –ü—Ä–µ–¥–ª–∞–≥–∞–π 2-4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
- –û–±—ä—è—Å–Ω—è–π –ø–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
- –†–∞–∑–±–∏–≤–∞–π —Å–ª–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –Ω–∞ —à–∞–≥–∏ (wizard)
- –£–≤–∞–∂–∞–π –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–µ –Ω–∞–≤—è–∑—ã–≤–∞–π —Å–≤–æ—ë –º–Ω–µ–Ω–∏–µ`;

    const messages: OpenAI.ChatCompletionMessageParam[] = [
        { role: "system", content: systemPrompt || defaultSystem },
        { role: "user", content: task },
    ];

    let iteration = 0;

    while (iteration &lt; 30) {
        iteration++;

        const response = await client.chat.completions.create({
            model: MODEL,
            messages,
            tools,
        });

        const message = response.choices[0].message;
        messages.push(message);

        // –ï—Å–ª–∏ –∞–≥–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç —Ç–µ–∫—Å—Ç–æ–º ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–∏–∞–ª–æ–≥
        if (!message.tool_calls?.length) {
            console.log(`\nü§ñ ${message.content}`);

            // –°–ø—Ä–∞—à–∏–≤–∞–µ–º, —Ö–æ—á–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
            const follow = await ask("\n&gt; (Enter —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å, –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ): ");
            if (!follow) {
                console.log("\nüëã –ó–∞–≤–µ—Ä—à–µ–Ω–æ.");
                rl.close();
                return;
            }

            messages.push({ role: "user", content: follow });
            continue;
        }

        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º tool calls
        for (const toolCall of message.tool_calls) {
            const name = toolCall.function.name;
            const args = JSON.parse(toolCall.function.arguments);

            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–∫—Ä–æ–º–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö ‚Äî –æ–Ω–∏ —Å–∞–º–∏ —Å–µ–±—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç)
            if (name === "think") {
                console.log(`\n  üí≠ ${args.thought}`);
            } else if (!name.startsWith("ask_user") &amp;&amp; name !== "write_file") {
                const preview = JSON.stringify(args).slice(0, 100);
                console.log(`  üîß ${name}(${preview})`);
            }

            const handler = toolHandlers[name];
            let result: string;

            if (handler) {
                const output = handler(args);
                result = output instanceof Promise ? await output : output;
            } else {
                result = `Tool "${name}" –Ω–µ –Ω–∞–π–¥–µ–Ω`;
            }

            // –õ–æ–≥–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–∫—Ä–æ–º–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏ think)
            if (!name.startsWith("ask_user") &amp;&amp; name !== "write_file" &amp;&amp; name !== "think") {
                console.log(`     ‚Üí ${result.slice(0, 120)}`);
            }

            messages.push({
                role: "tool",
                tool_call_id: toolCall.id,
                content: result,
            });
        }
    }

    rl.close();
}

// ============================================================
// –°–¶–ï–ù–ê–†–ò–ò
// ============================================================

async function main() {
    const scenario = process.argv[2] ?? "project";

    switch (scenario) {
        // --- –°—Ü–µ–Ω–∞—Ä–∏–π 1: Wizard –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ ---
        case "project":
            await interactiveAgent(
                "–ü–æ–º–æ–≥–∏ –º–Ω–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π TypeScript –ø—Ä–æ–µ–∫—Ç. " +
                "–°–ø—Ä–æ—Å–∏ —á—Ç–æ –∑–∞ –ø—Ä–æ–µ–∫—Ç, –ø—Ä–µ–¥–ª–æ–∂–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –Ω–∞—Å—Ç—Ä–æ–π –≤—Å—ë."
            );
            break;

        // --- –°—Ü–µ–Ω–∞—Ä–∏–π 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è–º–∏ ---
        case "refactor":
            await interactiveAgent(
                "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π .ts —Ñ–∞–π–ª—ã –≤ src/ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥. " +
                "–ü–æ–∫–∞–∂–∏ –º–Ω–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –¥–∞–π –≤—ã–±—Ä–∞—Ç—å —á—Ç–æ –¥–µ–ª–∞—Ç—å, –∏ –≤—ã–ø–æ–ª–Ω–∏ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è–º–∏."
            );
            break;

        // --- –°—Ü–µ–Ω–∞—Ä–∏–π 3: —Å–≤–æ–±–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º ---
        case "free":
            console.log("ü§ñ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∞–≥–µ–Ω—Ç –∑–∞–ø—É—â–µ–Ω. –í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É:\n");
            const task = await ask("&gt; ");
            await interactiveAgent(task);
            break;

        default:
            console.log("–°—Ü–µ–Ω–∞—Ä–∏–∏: npx tsx src/08-interactive-agent.ts [project|refactor|free]");
            rl.close();
    }
}

main();
</pre>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>

            <div class="step-detail">
                <p>–ì–ª–∞–≤–Ω–∞—è —Ö–∏—Ç—Ä–æ—Å—Ç—å: –º–æ–¥–µ–ª—å –Ω–µ –∑–Ω–∞–µ—Ç —á—Ç–æ —ç—Ç–∏ tool'—ã –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ. –î–ª—è –Ω–µ—ë <code>ask_user_choice</code> ‚Äî –æ–±—ã—á–Ω—ã–π tool, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É <code>"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª: ..."</code>. –í—Å—è –º–∞–≥–∏—è –≤ handlers ‚Äî –æ–Ω–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –∂–¥—É—Ç –≤–≤–æ–¥ —á–µ—Ä–µ–∑ <code>readline</code>.</p>
            </div>

            <button class="demo-btn" data-demo="demo-step-8">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ</button>

            <div class="demo-output demo-player" id="demo-step-8" data-demo-chat="step8" aria-live="polite">
                <div class="demo-player-header">
                    <div class="demo-player-title">–î–µ–º–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∏–∞–ª–æ–≥–∞</div>
                    <div class="demo-player-count"><span data-demo-index>1</span>/<span data-demo-total>4</span></div>
                </div>
                <div class="demo-chat-body" data-demo-chat-body></div>
                <div class="demo-player-controls">
                    <button class="demo-step-btn" data-demo-prev>‚Üê –ù–∞–∑–∞–¥</button>
                    <div class="demo-step-label" data-demo-label></div>
                    <button class="demo-step-btn" data-demo-next>–î–∞–ª–µ–µ ‚Üí</button>
                </div>
            </div>
            <div class="output-note" data-demo-note="demo-step-8">–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞. –£ —Ç–µ–±—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–∞—á–µ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.</div>

            <div class="run-command">
                <span class="run-icon">‚ñ∂</span>
                <code>npx tsx src/08-interactive-agent.ts project</code>
            </div>

            <div class="run-command">
                <span class="run-icon">‚ñ∂</span>
                <code>npx tsx src/08-interactive-agent.ts refactor</code>
            </div>

            <div class="run-command">
                <span class="run-icon">‚ñ∂</span>
                <code>npx tsx src/08-interactive-agent.ts free</code>
            </div>

            <div class="mini-block expect">
                <div class="mini-title">‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è</div>
                –ê–≥–µ–Ω—Ç –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å—ã, –∂–¥—ë—Ç –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é —Ñ–∞–π–ª–æ–≤.
            </div>

            <div class="mini-block trouble">
                <div class="mini-title">üßØ –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                –ó–∞–ø—É—Å–∫–∞–π –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ (–Ω–µ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞). –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ readline/STDIN –¥–æ—Å—Ç—É–ø–Ω—ã.
            </div>

            <div class="key-insight">
                <strong>üí° –ò—Ç–æ–≥:</strong> –ú–æ–¥–µ–ª—å —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–ª–æ—É, –Ω–æ —á–µ–ª–æ–≤–µ–∫ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –º–æ–∂–µ—Ç —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å.
                –ê–≥–µ–Ω—Ç –ø–æ–¥—É–º–∞–ª –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø—Ä–µ–¥–ª–æ–∂–∏–ª –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞—Ç—å.
                –≠—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤—Å–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ AI-–ø—Ä–æ–¥—É–∫—Ç—ã.
            </div>
        </div>
    </div>
</div>

</div><!-- /steps-container -->

<!-- ====== FOOTER ====== -->
<section class="footer">
    <div class="footer-title">–ß—Ç–æ —Ç—ã –ø–æ—Å—Ç—Ä–æ–∏–ª üéâ</div>
    <p>8 —à–∞–≥–æ–≤ ‚Äî –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ API-–≤—ã–∑–æ–≤–∞ –¥–æ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º wizard'–æ–º.</p>
    <div class="footer-steps">
        <span>01 ‚Üí <span class="term" data-tip="–ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å">LLM</span>-–≤—ã–∑–æ–≤</span>
        <span>02 ‚Üí + <span class="term" data-tip="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã/—Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å">tools</span> (–º–æ–¥–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏)</span>
        <span>03 ‚Üí + agent loop (—Ü–∏–∫–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)</span>
        <span>04 ‚Üí + —Ä–µ–∞–ª—å–Ω—ã–µ <span class="term" data-tip="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã/—Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å">tools</span> (bash, —Ñ–∞–π–ª—ã)</span>
        <span>05 ‚Üí + skills (–º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)</span>
        <span>06 ‚Üí + planning (think before act)</span>
        <span>07 ‚Üí + adaptive replan (–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –∫—É—Ä—Å–∞)</span>
        <span>08 ‚Üí + <span class="term" data-tip="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π">human-in-the-loop</span> + <span class="term" data-tip="–ü–æ—à–∞–≥–æ–≤—ã–π –º–∞—Å—Ç–µ—Ä/–≤–∏–∑–∞—Ä–¥">wizard</span></span>
    </div>
    <p style="margin-top: 2rem; color: var(--text-dim); font-size: 0.85rem;">
        –í–µ—Å—å –∫–æ–¥ ‚Äî —Ä–∞–±–æ—á–∏–π TypeScript, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ <code style="color: var(--cyan);">npx tsx</code>.<br>
        Claude Code, Cursor, GitHub Copilot ‚Äî —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —ç—Ç–∏—Ö –∂–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö.
    </p>
</section>

<!-- ====== PROGRESS MAP ====== -->
<nav class="progress-map" id="progressMap">
    <div class="progress-dot current" data-target="step-1" title="01: Basic Call"></div>
    <div class="progress-dot" data-target="step-2" title="02: First Tool"></div>
    <div class="progress-dot" data-target="step-3" title="03: Agent Loop"></div>
    <div class="progress-dot" data-target="step-4" title="04: Real Tools"></div>
    <div class="progress-dot" data-target="step-5" title="05: Skills"></div>
    <div class="progress-dot" data-target="step-6" title="06: Planning"></div>
    <div class="progress-dot" data-target="step-7" title="07: Adaptive"></div>
    <div class="progress-dot" data-target="step-8" title="08: Interactive"></div>
</nav>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
<script>
    // ====== Syntax Highlight (full files) ======
    document.querySelectorAll('.code-block').forEach(block => {
        const filename = block.querySelector('.code-filename')?.textContent?.trim() || '';
        if (!filename.startsWith('src/') || !filename.endsWith('.ts')) return;
        const pre = block.querySelector('pre');
        if (!pre || pre.querySelector('code')) return;
        const code = document.createElement('code');
        code.className = 'language-typescript';
        code.textContent = pre.textContent;
        pre.textContent = '';
        pre.appendChild(code);
    });

    if (window.hljs) {
        document.querySelectorAll('pre code').forEach((el) => hljs.highlightElement(el));
    }

    // ====== Step Toggle ======
    document.querySelectorAll('.step-card').forEach(card => {
        card.setAttribute('role', 'button');
        card.setAttribute('tabindex', '0');
        const parentStep = card.closest('.step');
        card.setAttribute('aria-expanded', parentStep?.classList.contains('active') ? 'true' : 'false');

        card.addEventListener('click', (e) => {
            // Don't toggle if clicking inside code or buttons
            if (e.target.closest('pre, button, .run-command, a, .demo-player')) return;

            const step = card.closest('.step');
            const wasActive = step.classList.contains('active');

            // Close all
            document.querySelectorAll('.step').forEach(s => {
                s.classList.remove('active');
                s.querySelector('.step-card')?.setAttribute('aria-expanded', 'false');
            });

            // Toggle clicked
            if (!wasActive) {
                step.classList.add('active');
                step.querySelector('.step-card')?.setAttribute('aria-expanded', 'true');
                updateProgress(step.dataset.step);
            }
        });

        card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                card.click();
            }
        });
    });

    // ====== Progress Map ======
    function updateProgress(activeStep) {
        const dots = document.querySelectorAll('.progress-dot');
        dots.forEach((dot, i) => {
            dot.classList.remove('current', 'done');
            if (i + 1 < activeStep) dot.classList.add('done');
            if (i + 1 == activeStep) dot.classList.add('current');
            dot.setAttribute('aria-current', i + 1 == activeStep ? 'step' : 'false');
        });
    }

    updateProgress(document.querySelector('.step.active')?.dataset.step || 1);

    document.querySelectorAll('.progress-dot').forEach(dot => {
        dot.setAttribute('role', 'button');
        dot.setAttribute('tabindex', '0');
        dot.setAttribute('aria-label', dot.getAttribute('title') || 'Step');
        dot.addEventListener('click', () => {
            const targetId = dot.dataset.target;
            const target = document.getElementById(targetId);
            if (target) {
                document.querySelectorAll('.step').forEach(s => {
                    s.classList.remove('active');
                    s.querySelector('.step-card')?.setAttribute('aria-expanded', 'false');
                });
                target.classList.add('active');
                target.querySelector('.step-card')?.setAttribute('aria-expanded', 'true');
                updateProgress(target.dataset.step);
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });

        dot.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                dot.click();
            }
        });
    });

    // ====== Copy Button ======
    function copyCode(btn) {
        const pre = btn.closest('.code-block').querySelector('pre');
        const text = pre.innerText;
        navigator.clipboard.writeText(text).then(() => {
            btn.textContent = '‚úì Copied';
            btn.classList.add('copied');
            setTimeout(() => {
                btn.textContent = 'Copy';
                btn.classList.remove('copied');
            }, 2000);
        });
    }

    function copyRunCommand(btn) {
        const code = btn.closest('.run-command')?.querySelector('code');
        if (!code) return;
        navigator.clipboard.writeText(code.innerText).then(() => {
            btn.textContent = '‚úì Copied';
            btn.classList.add('copied');
            setTimeout(() => {
                btn.textContent = 'Copy';
                btn.classList.remove('copied');
            }, 2000);
        });
    }

    // ====== Run Command Copy Buttons ======
    document.querySelectorAll('.run-command').forEach(cmd => {
        if (cmd.querySelector('.run-copy-btn')) return;
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'run-copy-btn';
        btn.textContent = 'Copy';
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            copyRunCommand(btn);
        });
        cmd.appendChild(btn);
    });

    // ====== Demo Buttons ======
    document.querySelectorAll('.demo-btn').forEach(btn => {
        const targetId = btn.dataset.demo;
        const target = targetId ? document.getElementById(targetId) : null;
        const note = targetId ? document.querySelector(`[data-demo-note="${targetId}"]`) : null;
        if (targetId) {
            btn.setAttribute('aria-controls', targetId);
        }
        if (target && target.classList.contains('visible')) {
            btn.textContent = '–°–∫—Ä—ã—Ç—å –¥–µ–º–æ';
            note?.classList.add('visible');
            btn.setAttribute('aria-expanded', 'true');
        } else {
            btn.setAttribute('aria-expanded', 'false');
        }
        btn.addEventListener('click', () => {
            const targetId = btn.dataset.demo;
            const target = document.getElementById(targetId);
            const note = document.querySelector(`[data-demo-note="${targetId}"]`);
            if (!target) return;
            const isVisible = target.classList.toggle('visible');
            note?.classList.toggle('visible', isVisible);
            btn.textContent = isVisible ? '–°–∫—Ä—ã—Ç—å –¥–µ–º–æ' : '‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ';
            btn.setAttribute('aria-expanded', isVisible ? 'true' : 'false');
        });
    });

    // ====== Demo Player (Step-by-step) ======
    const demoPlayers = {
        step8: [
            {
                label: "–í—ã–±–æ—Ä —Ç–∏–ø–∞",
                messages: [
                    { role: "user", text: "–ü–æ–º–æ–≥–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π REST API –ø—Ä–æ–µ–∫—Ç" },
                    { role: "llm", text: "–ü–æ–Ω–∏–º–∞—é –∑–∞–¥–∞—á—É. –°–Ω–∞—á–∞–ª–∞ —É—Ç–æ—á–Ω—é —Ç–∏–ø REST API –ø—Ä–æ–µ–∫—Ç–∞." },
                    { role: "tool_call", text: "ask_user_choice({\n  question: \"–ö–∞–∫–æ–π —Ç–∏–ø REST API –ø—Ä–æ–µ–∫—Ç–∞ —Ç—ã —Ö–æ—á–µ—à—å —Å–æ–∑–¥–∞—Ç—å?\",\n  options: [Express, Fastify, NestJS, Koa]\n})" },
                    { role: "tool_result", text: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª: Fastify (Node.js)" },
                    { role: "llm", text: "–û—Ç–ª–∏—á–Ω–æ. –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞." },
                ],
            },
            {
                label: "–ò–º—è –ø—Ä–æ–µ–∫—Ç–∞",
                messages: [
                    { role: "llm", text: "–°–ø—Ä–∞—à–∏–≤–∞—é –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏." },
                    { role: "tool_call", text: "ask_user_input({\n  question: \"–ö–∞–∫ –Ω–∞–∑–æ–≤—ë–º –ø—Ä–æ–µ–∫—Ç?\",\n  placeholder: \"my-rest-api\"\n})" },
                    { role: "tool_result", text: "todo-api" },
                    { role: "llm", text: "–ì–æ—Ç–æ–≤–ª—é –∫–æ–Ω—Ñ–∏–≥ –∏ –ø–æ–ø—Ä–æ—à—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é —Ñ–∞–π–ª–∞." },
                ],
            },
            {
                label: "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
                messages: [
                    { role: "llm", text: "–°–æ–±—Ä–∞–ª package.json. –ù–∞–¥–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å." },
                    { role: "tool_call", text: "ask_user_confirm({\n  question: \"–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç —Å —ç—Ç–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π?\",\n  preview: \"{ name: 'todo-api', scripts: { dev: 'nodemon src/index.js' } }\"\n})" },
                    { role: "tool_result", text: "y" },
                    { role: "llm", text: "–ó–∞–ø–∏—Å—ã–≤–∞—é —Ñ–∞–π–ª package.json." },
                ],
            },
            {
                label: "–ó–∞–ø–∏—Å—å",
                messages: [
                    { role: "tool_call", text: "write_file({ path: \"package.json\", content: \"...\" })" },
                    { role: "tool_result", text: "‚úÖ –§–∞–π–ª package.json –∑–∞–ø–∏—Å–∞–Ω" },
                    { role: "llm", text: "–ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω. –ú–æ–≥—É –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏." },
                ],
            },
        ],
    };

    function initDemoPlayer(player) {
        const key = player.dataset.demoChat;
        const steps = demoPlayers[key];
        if (!steps || steps.length === 0) return;

        const bodyEl = player.querySelector('[data-demo-chat-body]');
        const labelEl = player.querySelector('[data-demo-label]');
        const indexEl = player.querySelector('[data-demo-index]');
        const totalEl = player.querySelector('[data-demo-total]');
        const prevBtn = player.querySelector('[data-demo-prev]');
        const nextBtn = player.querySelector('[data-demo-next]');

        let index = 0;
        totalEl.textContent = String(steps.length);

        const render = () => {
            const step = steps[index];
            const messages = step.messages || [];
            bodyEl.innerHTML = messages.map((m) => {
                const role = m.role || "llm";
                const label = role === "tool_call" ? "tool_call"
                    : role === "tool_result" ? "tool_result"
                    : role === "user" ? "user"
                    : "LLM";
                const cls = role === "tool_call" ? "toolcall"
                    : role === "tool_result" ? "toolresult"
                    : role === "user" ? "user"
                    : "llm";
                return `\n<div class="chat-msg ${cls}">\n  <div class="chat-msg-label">${label}</div>\n  <div>${m.text || ""}</div>\n</div>`;
            }).join("");
            labelEl.textContent = step.label || `–®–∞–≥ ${index + 1}`;
            indexEl.textContent = String(index + 1);
            prevBtn.disabled = index === 0;
            nextBtn.disabled = index === steps.length - 1;
        };

        prevBtn.addEventListener('click', () => {
            if (index > 0) {
                index -= 1;
                render();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (index < steps.length - 1) {
                index += 1;
                render();
            }
        });

        render();
    }

    document.querySelectorAll('[data-demo-chat]').forEach(initDemoPlayer);

    // ====== Tooltip focus ======
    document.querySelectorAll('.term').forEach(term => {
        term.setAttribute('tabindex', '0');
    });

    // ====== Smooth Scroll for CTA ======
    document.querySelector('.hero-cta')?.addEventListener('click', (e) => {
        e.preventDefault();
        document.getElementById('step-0')?.scrollIntoView({ behavior: 'smooth' });
    });

    // ====== Scroll-based step activation ======
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const step = entry.target;
                if (step.dataset.step) {
                    updateProgress(step.dataset.step);
                }
            }
        });
    }, { threshold: 0.3 });

    document.querySelectorAll('.step').forEach(step => observer.observe(step));
</script>

</body>
</html>
