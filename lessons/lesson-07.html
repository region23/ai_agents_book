<div class="step" data-step="7" id="step-7">
            <div class="step-number">07</div>
            <div class="step-card">
                <div class="step-header">
                    <div class="step-title">Adaptive Agent ‚Äî Plan + <span class="term"
                            data-tip="–ß–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –∏ –¥–µ–π—Å—Ç–≤–∏–π">ReAct</span> + Replan</div>
                    <span class="step-badge advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</span>
                </div>
                <p class="step-intro">
                    –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ–±–∞ –ø–æ–¥—Ö–æ–¥–∞: –∞–≥–µ–Ω—Ç –ø–ª–∞–Ω–∏—Ä—É–µ—Ç, –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è–º–∏, –∏ –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–ª–∞–Ω –µ—Å–ª–∏
                    —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Å–æ–≤–ø–∞–ª–∞ —Å –æ–∂–∏–¥–∞–Ω–∏—è–º–∏.
                </p>

                <div class="step-content">
                    <div class="arch-diagram">
                        <div class="loop-flow">
                            <span class="loop-node llm">Plan</span>
                            <span class="loop-arrow">‚Üí</span>
                            <span class="loop-node output">ReAct Execute</span>
                            <span class="loop-arrow">‚Üí</span>
                            <span class="loop-node tool">Replan?</span>
                            <span class="loop-arrow">‚Üí</span>
                            <span class="loop-node context">Execute</span>
                            <span class="loop-arrow">‚Üí</span>
                            <span class="loop-node llm">Done</span>
                        </div>
                    </div>

                    <div class="step-detail">
                        <p>–≠—Ç–æ –∏ –µ—Å—Ç—å —Ç–æ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã. –¢—Ä–∏ —Ñ–∞–∑—ã –≤ —Ü–∏–∫–ª–µ:</p>
                        <p><strong>–§–∞–∑–∞ 1: Plan</strong> ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π LLM-–≤—ã–∑–æ–≤ –±–µ–∑ tools. –ú–æ–¥–µ–ª—å —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç
                            —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON-–ø–ª–∞–Ω,
                            –Ω–µ –∑–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã.</p>
                        <p><strong>–§–∞–∑–∞ 2: ReAct Execute</strong> ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–ª–∞–Ω —Å <code>think</code> tool.
                            –ù–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –¥—É–º–∞–µ—Ç: ¬´—Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å —Å –ø–ª–∞–Ω–æ–º?¬ª –ï—Å–ª–∏ –º–µ–ª–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî
                            –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ª–µ—Ç—É.</p>
                        <p><strong>–§–∞–∑–∞ 3: Replan</strong> ‚Äî –µ—Å–ª–∏ –∞–≥–µ–Ω—Ç –≤—ã–∑–≤–∞–ª <code>request_replan</code>, —Ü–∏–∫–ª
                            –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é.
                            –ù–æ —Ç–µ–ø–µ—Ä—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–Ω–∞–µ—Ç: —á—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ, —á—Ç–æ –Ω–æ–≤–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏, –ø–æ—á–µ–º—É —Å—Ç–∞—Ä—ã–π –ø–ª–∞–Ω –Ω–µ
                            –ø–æ–¥—Ö–æ–¥–∏—Ç.
                            –≠—Ç–æ –æ—Ç–ª–∏—á–∞–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –æ—Ç —Ç—É–ø–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è.</p>
                    </div>

                    <div class="code-block">
                        <div class="code-filename"><span class="dot"></span>request_replan tool</div>
                        <pre>{
    <span class="prop">name</span>: <span class="str">"request_replan"</span>,
    <span class="prop">description</span>: <span class="str">"–í—ã–∑–æ–≤–∏ –∫–æ–≥–¥–∞ –ø–ª–∞–Ω –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å"</span>,
    <span class="prop">parameters</span>: {
        <span class="prop">reason</span>: <span class="str">"–ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω –Ω–æ–≤—ã–π –ø–ª–∞–Ω"</span>,
        <span class="prop">completed_steps</span>: [<span class="str">"–ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ"</span>],
        <span class="prop">discoveries</span>: [<span class="str">"–ß—Ç–æ –Ω–æ–≤–æ–≥–æ —É–∑–Ω–∞–ª–∏"</span>],
    }
}

<span class="cm">// –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª:</span>
<span class="kw">while</span> (replanCount &lt;= MAX_REPLANS) {
    <span class="kw">const</span> result = <span class="kw">await</span> <span class="fn">executeWithReact</span>(task, plan);
    <span class="kw">if</span> (result.status === <span class="str">"completed"</span>) <span class="kw">return</span>;

    <span class="cm">// –†–µ–ø–ª–∞–Ω —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Ç–æ–≥–æ, —á—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ</span>
    plan = <span class="kw">await</span> <span class="fn">createPlan</span>(task, {
        <span class="prop">previousPlan</span>: plan,
        <span class="prop">completedSteps</span>: result.replanContext.completedSteps,
        <span class="prop">discoveries</span>: result.replanContext.discoveries,
    });
}</pre>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <div class="code-block">
                        <div class="code-filename"><span class="dot"></span>src/07-adaptive-agent.ts</div>
                        <pre>// src/07-adaptive-agent.ts
// –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∞–≥–µ–Ω—Ç: Plan ‚Üí ReAct Execute ‚Üí Replan –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
import OpenAI from "openai";
import { execSync } from "child_process";
import { readFileSync, writeFileSync } from "fs";
import dotenv from "dotenv";

dotenv.config();

const client = new OpenAI({
    baseURL: "https://openrouter.ai/api/v1",
    apiKey: process.env.OPENROUTER_API_KEY ?? "",
});

const MODEL = "anthropic/claude-sonnet-4.5";

// ============================================================
// TOOLS
// ============================================================

const executionTools: OpenAI.ChatCompletionTool[] = [
    {
        type: "function",
        function: {
            name: "think",
            description:
                "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–ª–æ–∫–Ω–æ—Ç. –ò—Å–ø–æ–ª—å–∑—É–π –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º —á—Ç–æ–±—ã –æ–±–¥—É–º–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥, " +
                "–∏ –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.",
            parameters: {
                type: "object",
                properties: {
                    thought: { type: "string", description: "–†–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ" },
                },
                required: ["thought"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "run_bash",
            description: "–í—ã–ø–æ–ª–Ω–∏—Ç—å bash-–∫–æ–º–∞–Ω–¥—É",
            parameters: {
                type: "object",
                properties: {
                    command: { type: "string", description: "–ö–æ–º–∞–Ω–¥–∞" },
                },
                required: ["command"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "read_file",
            description: "–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª",
            parameters: {
                type: "object",
                properties: {
                    path: { type: "string", description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É" },
                },
                required: ["path"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "write_file",
            description: "–ó–∞–ø–∏—Å–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ —Ñ–∞–π–ª",
            parameters: {
                type: "object",
                properties: {
                    path: { type: "string", description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É" },
                    content: { type: "string", description: "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ" },
                },
                required: ["path", "content"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "request_replan",
            description:
                "–í—ã–∑–æ–≤–∏ –∫–æ–≥–¥–∞ –ø–ª–∞–Ω –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å: –æ–±–Ω–∞—Ä—É–∂–∏–ª–∞—Å—å –Ω–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, " +
                "—à–∞–≥ –ø—Ä–æ–≤–∞–ª–∏–ª—Å—è, –∏–ª–∏ –ø–æ—è–≤–∏–ª—Å—è –ª—É—á—à–∏–π –ø—É—Ç—å –∫ —Ü–µ–ª–∏.",
            parameters: {
                type: "object",
                properties: {
                    reason: { type: "string", description: "–ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω –Ω–æ–≤—ã–π –ø–ª–∞–Ω" },
                    completed_steps: {
                        type: "array",
                        items: { type: "string" },
                        description: "–ö–∞–∫–∏–µ —à–∞–≥–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã",
                    },
                    discoveries: {
                        type: "array",
                        items: { type: "string" },
                        description: "–ß—Ç–æ –Ω–æ–≤–æ–≥–æ —É–∑–Ω–∞–ª–∏",
                    },
                },
                required: ["reason", "completed_steps", "discoveries"],
            },
        },
    },
];

const toolHandlers: Record&lt;string, (args: any) =&gt; string&gt; = {
    think: () =&gt; "OK",
    run_bash: ({ command }) =&gt; {
        try {
            return execSync(command, { encoding: "utf-8", timeout: 10000 }).trim();
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.stderr || e.message}`;
        }
    },
    read_file: ({ path }) =&gt; {
        try {
            return readFileSync(path, "utf-8");
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.message}`;
        }
    },
    write_file: ({ path, content }) =&gt; {
        try {
            writeFileSync(path, content, "utf-8");
            return `‚úÖ –§–∞–π–ª ${path} –∑–∞–ø–∏—Å–∞–Ω (${content.length} –±–∞–π—Ç)`;
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.message}`;
        }
    },
    request_replan: () =&gt; "REPLAN_REQUESTED",
};

// ============================================================
// –§–ê–ó–ê 1: –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–ï
// ============================================================

interface Plan {
    goal: string;
    steps: { id: number; action: string; tool: string; reason: string }[];
}

async function createPlan(
    task: string,
    context?: { previousPlan?: Plan; completedSteps?: string[]; discoveries?: string[] }
): Promise&lt;Plan&gt; {
    let systemPrompt = `–¢—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫. –°–æ—Å—Ç–∞–≤—å –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: run_bash, read_file, write_file.

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–º JSON:
{
  "goal": "–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏",
  "steps": [
    { "id": 1, "action": "–æ–ø–∏—Å–∞–Ω–∏–µ", "tool": "–∏–º—è_tool", "reason": "–∑–∞—á–µ–º" }
  ]
}`;

    // –ï—Å–ª–∏ —ç—Ç–æ —Ä–µ–ø–ª–∞–Ω ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
    if (context?.previousPlan) {
        systemPrompt += `

–ö–û–ù–¢–ï–ö–°–¢ –†–ï–ü–õ–ê–ù–ê:
–ü—Ä–µ–¥—ã–¥—É—â–∏–π –ø–ª–∞–Ω: ${JSON.stringify(context.previousPlan)}
–£–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: ${context.completedSteps?.join(", ") || "–Ω–∏—á–µ–≥–æ"}
–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: ${context.discoveries?.join("; ") || "–Ω–µ—Ç"}

–£—á—Ç–∏ —á—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ, –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏.
–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π –ø–ª–∞–Ω —Å —É—á—ë—Ç–æ–º –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.`;
    }

    const response = await client.chat.completions.create({
        model: MODEL,
        messages: [
            { role: "system", content: systemPrompt },
            { role: "user", content: task },
        ],
    });

    const text = response.choices[0].message.content ?? "";
    const cleanJson = text.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
    return JSON.parse(cleanJson);
}

function printPlan(plan: Plan, isReplan: boolean = false) {
    const label = isReplan ? "üîÑ –ù–û–í–´–ô –ü–õ–ê–ù" : "üìã –ü–õ–ê–ù";
    console.log(`\n${label}: ${plan.goal}`);
    console.log("‚îÄ".repeat(50));
    plan.steps.forEach((s) =&gt; {
        console.log(`  ${s.id}. [${s.tool}] ${s.action}`);
        console.log(`     ‚îî‚îÄ ${s.reason}`);
    });
    console.log("‚îÄ".repeat(50));
}

// ============================================================
// –§–ê–ó–ê 2: –í–´–ü–û–õ–ù–ï–ù–ò–ï —Å ReAct + –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–ø–ª–∞–Ω–∞
// ============================================================

interface ExecutionResult {
    status: "completed" | "replan_requested";
    replanContext?: {
        reason: string;
        completedSteps: string[];
        discoveries: string[];
    };
}

async function executeWithReact(
    task: string,
    plan: Plan
): Promise&lt;ExecutionResult&gt; {
    const messages: OpenAI.ChatCompletionMessageParam[] = [
        {
            role: "system",
            content: `–¢—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å —Å –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–º –º—ã—à–ª–µ–Ω–∏–µ–º.

–¢–í–û–ô –ü–õ–ê–ù:
${JSON.stringify(plan, null, 2)}

–ú–ï–¢–û–î –†–ê–ë–û–¢–´:
1. –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º ‚Äî –≤—ã–∑–æ–≤–∏ "think": –æ–±–¥—É–º–∞–π —à–∞–≥, –ø—Ä–æ–≤–µ—Ä—å —á—Ç–æ –æ–Ω –≤—Å—ë –µ—â—ë –∞–∫—Ç—É–∞–ª–µ–Ω
2. –í—ã–ø–æ–ª–Ω–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω—É–∂–Ω—ã–º tool
3. –ü–æ—Å–ª–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Äî —Å–Ω–æ–≤–∞ "think": –æ—Ü–µ–Ω–∏, —Å–æ–≤–ø–∞–ª–æ –ª–∏ —Å –æ–∂–∏–¥–∞–Ω–∏—è–º–∏
4. –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª —á—Ç–æ –ø–ª–∞–Ω –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å ‚Äî –≤—ã–∑–æ–≤–∏ "request_replan"

–ö–û–ì–î–ê –í–´–ó–´–í–ê–¢–¨ request_replan:
- –û–±–Ω–∞—Ä—É–∂–∏–ª —á—Ç–æ-—Ç–æ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ (—Ñ–∞–π–ª–æ–≤ –±–æ–ª—å—à–µ/–º–µ–Ω—å—à–µ —á–µ–º –¥—É–º–∞–ª–∏)
- –®–∞–≥ –ø—Ä–æ–≤–∞–ª–∏–ª—Å—è –∏ –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å —Ç—Ä–µ–±—É–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞
- –ü–æ—è–≤–∏–ª–∞—Å—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —à–∞–≥–∏ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏
- –ù–∞—à—ë–ª –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å –∫ —Ü–µ–ª–∏

–ù–ï –≤—ã–∑—ã–≤–∞–π replan –¥–ª—è –º–µ–ª–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º ‚Äî –∞–¥–∞–ø—Ç–∏—Ä—É–π—Å—è –Ω–∞ –ª–µ—Ç—É.
–í—ã–∑—ã–≤–∞–π —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –∫—É—Ä—Å–∞.`,
        },
        { role: "user", content: task },
    ];

    let iteration = 0;

    while (iteration &lt; 20) {
        iteration++;

        const response = await client.chat.completions.create({
            model: MODEL,
            messages,
            tools: executionTools,
        });

        const message = response.choices[0].message;
        messages.push(message);

        if (!message.tool_calls?.length) {
            console.log(`\n‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ (${iteration} –∏—Ç–µ—Ä–∞—Ü–∏–π)`);
            console.log("–ò—Ç–æ–≥:", message.content?.slice(0, 300));
            return { status: "completed" };
        }

        for (const toolCall of message.tool_calls) {
            const name = toolCall.function.name;
            const args = JSON.parse(toolCall.function.arguments);

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥
            if (name === "think") {
                console.log(`\n  üí≠ ${args.thought}`);
            } else if (name === "request_replan") {
                console.log(`\n  üîÑ –†–ï–ü–õ–ê–ù: ${args.reason}`);
                messages.push({
                    role: "tool",
                    tool_call_id: toolCall.id,
                    content: "REPLAN_REQUESTED",
                });
                return {
                    status: "replan_requested",
                    replanContext: {
                        reason: args.reason,
                        completedSteps: args.completed_steps,
                        discoveries: args.discoveries,
                    },
                };
            } else {
                const argsPreview =
                    name === "write_file"
                        ? `{path: "${args.path}", content: [${args.content.length} chars]}`
                        : JSON.stringify(args);
                console.log(`  üîß ${name}(${argsPreview})`);

                const result = toolHandlers[name]?.(args) ?? `Tool "${name}" –Ω–µ –Ω–∞–π–¥–µ–Ω`;
                console.log(`     ‚Üí ${result.slice(0, 120)}`);
            }

            messages.push({
                role: "tool",
                tool_call_id: toolCall.id,
                content: toolHandlers[name]?.(args) ?? "OK",
            });
        }
    }

    return { status: "completed" };
}

// ============================================================
// –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ: Plan ‚Üí Execute ‚Üí Replan ‚Üí Execute ‚Üí ...
// ============================================================

async function adaptiveAgent(task: string) {
    console.log("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    console.log("‚ïë   ADAPTIVE AGENT: Plan + ReAct + Replan      ‚ïë");
    console.log("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
    console.log(`\nüìå –ó–∞–¥–∞—á–∞: ${task}\n`);

    let plan = await createPlan(task);
    printPlan(plan);

    const MAX_REPLANS = 3;
    let replanCount = 0;

    while (replanCount &lt;= MAX_REPLANS) {
        console.log(`\n‚ö° –í–´–ü–û–õ–ù–ï–ù–ò–ï (–ø–ª–∞–Ω v${replanCount + 1})\n`);

        const result = await executeWithReact(task, plan);

        if (result.status === "completed") {
            console.log("\nüéâ –ê–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∏–ª –∑–∞–¥–∞—á—É.");
            return;
        }

        // –†–µ–ø–ª–∞–Ω
        replanCount++;
        if (replanCount &gt; MAX_REPLANS) {
            console.log("\n‚ö†Ô∏è  –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Ä–µ–ø–ª–∞–Ω–æ–≤. –ó–∞–≤–µ—Ä—à–∞–µ–º —Å —Ç–µ–∫—É—â–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.");
            return;
        }

        console.log(`\nüìã –†–ï–ü–õ–ê–ù #${replanCount}...`);
        plan = await createPlan(task, {
            previousPlan: plan,
            completedSteps: result.replanContext?.completedSteps,
            discoveries: result.replanContext?.discoveries,
        });
        printPlan(plan, true);
    }
}

// ============================================================
// –ó–ê–ü–£–°–ö
// ============================================================

const task =
    process.argv[2] ||
    "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤—Å–µ .ts —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ src/. " +
    "–ù–∞–π–¥–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏ (–æ–±—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, " +
    "–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∏–º–ø–æ—Ä—Ç—ã, –ø–æ—Ö–æ–∂–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏). " +
    "–°–æ–∑–¥–∞–π —Ñ–∞–π–ª REFACTORING.md —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.";

adaptiveAgent(task);
</pre>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>

                    <div class="run-command">
                        <span class="run-icon">‚ñ∂</span>
                        <code>npx tsx src/07-adaptive-agent.ts</code>
                    </div>

                    <button class="demo-btn" data-demo="demo-step-7">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ</button>

                    <div class="demo-output demo-player" id="demo-step-7" data-demo-chat="step7" aria-live="polite">
                        <div class="demo-player-header">
                            <div class="demo-player-title">–î–µ–º–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∏–∞–ª–æ–≥–∞</div>
                            <div class="demo-player-count"><span data-demo-index>1</span>/<span data-demo-total>1</span>
                            </div>
                        </div>
                        <div class="demo-chat-body" data-demo-chat-body></div>
                        <div class="demo-player-controls">
                            <button class="demo-step-btn" data-demo-prev>‚Üê –ù–∞–∑–∞–¥</button>
                            <div class="demo-step-label" data-demo-label></div>
                            <button class="demo-step-btn" data-demo-next>–î–∞–ª–µ–µ ‚Üí</button>
                        </div>
                    </div>
                    <div class="output-note" data-demo-note="demo-step-7">–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞. –£ —Ç–µ–±—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–∞—á–µ ‚Äî —ç—Ç–æ
                        –Ω–æ—Ä–º–∞–ª—å–Ω–æ.</div>

                    <div class="mini-block expect">
                        <div class="mini-title">‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è</div>
                        –í–∏–¥–Ω–æ, —á—Ç–æ –∞–≥–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ –Ω–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ—Ç—Å—è: –µ—Å—Ç—å –ª–∏–º–∏—Ç –Ω–∞ —Ä–µ–ø–ª–∞–Ω.
                    </div>

                    <div class="mini-block trouble">
                        <div class="mini-title">üßØ –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                        –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ <code>request_replan</code> –æ–±—ä—è–≤–ª–µ–Ω –∫–∞–∫ tool –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Ü–∏–∫–ª–µ.
                    </div>

                    <div class="key-insight">
                        <strong>üí° –≠—Ç–æ –æ—Ç–ª–∏—á–∞–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –æ—Ç —Ç—É–ø–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è:</strong>
                        –æ–Ω –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω, –Ω–æ –∏ –Ω–µ –±—É–¥–µ—Ç —Ä–µ–ø–ª—ç–Ω–∏—Ç—å –Ω–∞ –∫–∞–∂–¥—ã–π —á–∏—Ö.
                        –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–∏ —Ä–µ–ø–ª–∞–Ω–µ –∑–Ω–∞–µ—Ç: —á—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ, —á—Ç–æ –Ω–æ–≤–æ–≥–æ —É–∑–Ω–∞–ª–∏, –ø–æ—á–µ–º—É —Å—Ç–∞—Ä—ã–π –ø–ª–∞–Ω –Ω–µ
                        –ø–æ–¥—Ö–æ–¥–∏—Ç.
                    </div>
                </div>
            </div>
        </div>

<!-- –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∞ -->
<script type="application/json" data-demo-steps="step7">
[
    {
        "label": "–ü–ª–∞–Ω",
        "messages": [
            {
                "role": "user",
                "text": "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤—Å–µ .ts —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ src/. –ù–∞–π–¥–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏ (–æ–±—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∏–º–ø–æ—Ä—Ç—ã, –ø–æ—Ö–æ–∂–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏). –°–æ–∑–¥–∞–π —Ñ–∞–π–ª REFACTORING.md —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏."
            },
            {
                "role": "llm",
                "text": "üìã –ü–õ–ê–ù: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ .ts —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ src/, –Ω–∞–π—Ç–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –∏ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª REFACTORING.md —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n  1. [run_bash] –ù–∞–π—Ç–∏ –≤—Å–µ .ts —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ src/ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ\n     ‚îî‚îÄ –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ TypeScript —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞\n  2. [read_file] –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∂–¥–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ .ts —Ñ–∞–π–ª–∞\n     ‚îî‚îÄ –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è\n  3. [run_bash] –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö\n     ‚îî‚îÄ –ò–∑–≤–ª–µ—á—å –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–º–ø–æ—Ä—Ç–æ–≤ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤\n  4. [read_file] –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∫–æ–¥–∞, –ø–æ—Ö–æ–∂–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ–±—â–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã\n     ‚îî‚îÄ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏\n  5. [write_file] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª REFACTORING.md —Å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É\n     ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
            }
        ]
    },
    {
        "label": "–°–±–æ—Ä —Ñ–∞–π–ª–æ–≤",
        "messages": [
            {
                "role": "tool_call",
                "text": "run_bash({\"command\":\"find src/ -name \\\"*.ts\\\" -type f 2>/dev/null | sort\"})"
            },
            {
                "role": "tool_result",
                "text": "src/01-basic-call.ts\nsrc/02-with-tool.ts\nsrc/03-agent-loop.ts\nsrc/04-real-tools.ts\nsrc/05-skills.ts\nsrc/06-planning.ts\ns"
            },
            {
                "role": "tool_call",
                "text": "read_file({\"path\":\"src/01-basic-call.ts\"})"
            },
            {
                "role": "tool_result",
                "text": "// src/01-basic-call.ts\nimport OpenAI from \"openai\";\nimport dotenv from \"dotenv\";\n\ndotenv.config();\n\nconst client = new "
            }
        ]
    },
    {
        "label": "–ê–Ω–∞–ª–∏–∑",
        "messages": [
            {
                "role": "tool_call",
                "text": "run_bash({\"command\":\"grep -n \\\"import OpenAI\\\" src/*.ts\"})"
            },
            {
                "role": "tool_result",
                "text": "src/01-basic-call.ts:2:import OpenAI from \"openai\";\nsrc/02-with-tool.ts:2:import OpenAI from \"openai\";\nsrc/03-agent-loop"
            },
            {
                "role": "tool_call",
                "text": "run_bash({\"command\":\"grep -n \\\"run_bash:\\\" src/*.ts | head -20\"})"
            },
            {
                "role": "tool_result",
                "text": "src/04-real-tools.ts:52:    run_bash: ({ command }) => {\nsrc/05-skills.ts:108:        run_bash: ({ command }) => {\nsrc/0"
            },
            {
                "role": "tool_call",
                "text": "run_bash({\"command\":\"wc -l src/*.ts\"})"
            },
            {
                "role": "tool_result",
                "text": "23 src/01-basic-call.ts\n      61 src/02-with-tool.ts\n     118 src/03-agent-loop.ts\n     123 src/04-real-tools.ts\n     21"
            }
        ]
    },
    {
        "label": "–ó–∞–ø–∏—Å—å –æ—Ç—á—ë—Ç–∞",
        "messages": [
            {
                "role": "tool_call",
                "text": "write_file({path: \"REFACTORING.md\", content: [14820 chars]})"
            },
            {
                "role": "tool_result",
                "text": "‚úÖ –§–∞–π–ª REFACTORING.md –∑–∞–ø–∏—Å–∞–Ω (14820 –±–∞–π—Ç)"
            }
        ]
    },
    {
        "label": "–ò—Ç–æ–≥",
        "messages": [
            {
                "role": "llm",
                "text": "üéâ –ê–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∏–ª –∑–∞–¥–∞—á—É.\n\n**–ù–∞–π–¥–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:**\n- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OpenAI –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî 8 —Ñ–∞–π–ª–æ–≤\n- Tool definitions (run_bash, read_file) ‚Äî 5 —Ñ–∞–π–ª–æ–≤\n- Tool handlers ‚Äî ~150 —Å—Ç—Ä–æ–∫ –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞\n\n**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –≤—ã–Ω–µ—Å—Ç–∏ –æ–±—â–∏–µ —á–∞—Å—Ç–∏ –≤ `src/lib/client.ts` –∏ `src/lib/tools.ts`\n\n–û—Ç—á—ë—Ç –∑–∞–ø–∏—Å–∞–Ω –≤ `REFACTORING.md`."
            }
        ]
    }
]
</script>
