<div class="step" data-step="4" id="step-4">
            <div class="step-number">04</div>
            <div class="step-card">
                <div class="step-header">
                    <div class="step-title">–†–µ–∞–ª—å–Ω—ã–µ Tools ‚Äî bash –∏ —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞</div>
                    <span class="step-badge intermediate">–ü—Ä–∞–∫—Ç–∏–∫–∞</span>
                </div>
                <p class="step-intro">
                    –ó–∞–º–µ–Ω—è–µ–º —Ñ–µ–π–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç–æ—è—â–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏. –ê–≥–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã –∏ —á–∏—Ç–∞—Ç—å
                    —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ <span class="term" data-tip="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç/—Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª—å">tools</span>.
                    –ó–∞–ø—É—Å—Ç–∏ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏: 5 –∏—Ç–µ—Ä–∞—Ü–∏–π, –º–æ–¥–µ–ª—å —Å–∞–º–∞ —Ä–µ—à–∏–ª–∞ —á—Ç–æ –¥–µ–ª–∞—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ ‚Äî <code>ls</code>,
                    <code>read_file</code>, –æ—à–∏–±–∫–∞, –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å, –æ—Ç–≤–µ—Ç.
                </p>

                <div class="step-content">
                    <div class="step-detail">
                        <p>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞ –∂–µ ‚Äî agent loop. –ù–æ tools —Ç–µ–ø–µ—Ä—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π:</p>
                    </div>

                    <div class="code-block">
                        <div class="code-filename"><span class="dot"></span>src/04-real-tools.ts</div>
                        <pre>// src/04-real-tools.ts
import OpenAI from "openai";
import { execSync } from "child_process";
import { readFileSync } from "fs";
import dotenv from "dotenv";

dotenv.config();

const client = new OpenAI({
    baseURL: "https://openrouter.ai/api/v1",
    apiKey: process.env.OPENROUTER_API_KEY ?? "",
});

const tools: OpenAI.ChatCompletionTool[] = [
    {
        type: "function",
        function: {
            name: "run_bash",
            description: "–í—ã–ø–æ–ª–Ω–∏—Ç—å bash-–∫–æ–º–∞–Ω–¥—É –∏ –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –¢–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ read-only –∫–æ–º–∞–Ω–¥—ã.",
            parameters: {
                type: "object",
                properties: {
                    command: {
                        type: "string",
                        description: "Bash-–∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è",
                    },
                },
                required: ["command"],
            },
        },
    },
    {
        type: "function",
        function: {
            name: "read_file",
            description: "–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞",
            parameters: {
                type: "object",
                properties: {
                    path: {
                        type: "string",
                        description: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É",
                    },
                },
                required: ["path"],
            },
        },
    },
];

const toolHandlers: Record&lt;string, (args: any) =&gt; string&gt; = {
    run_bash: ({ command }) =&gt; {
        try {
            return execSync(command, {
                encoding: "utf-8",
                timeout: 5000,
            }).trim();
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.message}`;
        }
    },
    read_file: ({ path }) =&gt; {
        try {
            return readFileSync(path, "utf-8");
        } catch (e: any) {
            return `–û—à–∏–±–∫–∞: ${e.message}`;
        }
    },
};

async function agentLoop(userMessage: string) {
    const messages: OpenAI.ChatCompletionMessageParam[] = [
        {
            role: "system",
            content: `–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ.
–ú–æ–∂–µ—à—å –≤—ã–ø–æ–ª–Ω—è—Ç—å bash-–∫–æ–º–∞–Ω–¥—ã –∏ —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã.
–û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º.`,
        },
        { role: "user", content: userMessage },
    ];

    let iteration = 0;

    while (iteration &lt; 10) {
        iteration++;
        console.log(`\n--- –ò—Ç–µ—Ä–∞—Ü–∏—è ${iteration} ---`);

        const response = await client.chat.completions.create({
            model: "anthropic/claude-sonnet-4.5",
            messages,
            tools,
        });

        const message = response.choices[0].message;
        messages.push(message);

        if (!message.tool_calls?.length) {
            console.log("\n–ê–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É.");
            console.log("–û—Ç–≤–µ—Ç:", message.content);
            return;
        }

        for (const toolCall of message.tool_calls) {
            const name = toolCall.function.name;
            const args = JSON.parse(toolCall.function.arguments);
            console.log(`Tool: ${name}(${JSON.stringify(args)})`);

            const result = toolHandlers[name]?.(args)
                ?? `Tool "${name}" –Ω–µ –Ω–∞–π–¥–µ–Ω`;

            console.log(`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result.slice(0, 200)}...`);

            messages.push({
                role: "tool",
                tool_call_id: toolCall.id,
                content: result,
            });
        }
    }
}

// –¢–µ–ø–µ—Ä—å –∞–≥–µ–Ω—Ç –º–æ–∂–µ—Ç —Ä–µ–∞–ª—å–Ω–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–≤–æ—é —Å–∏—Å—Ç–µ–º—É
agentLoop("–ü–æ—Å–º–æ—Ç—Ä–∏ —á—Ç–æ –∑–∞ –ø—Ä–æ–µ–∫—Ç –ª–µ–∂–∏—Ç –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –ö–∞–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã?");
</pre>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>

                    <div class="run-command">
                        <span class="run-icon">‚ñ∂</span>
                        <code>npx tsx src/04-real-tools.ts</code>
                    </div>

                    <button class="demo-btn" data-demo="demo-step-4">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ</button>

                    <div class="demo-output demo-player" id="demo-step-4" data-demo-chat="step4" aria-live="polite">
                        <div class="demo-player-header">
                            <div class="demo-player-title">–î–µ–º–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∏–∞–ª–æ–≥–∞</div>
                            <div class="demo-player-count"><span data-demo-index>1</span>/<span data-demo-total>1</span>
                            </div>
                        </div>
                        <div class="demo-chat-body" data-demo-chat-body></div>
                        <div class="demo-player-controls">
                            <button class="demo-step-btn" data-demo-prev>‚Üê –ù–∞–∑–∞–¥</button>
                            <div class="demo-step-label" data-demo-label></div>
                            <button class="demo-step-btn" data-demo-next>–î–∞–ª–µ–µ ‚Üí</button>
                        </div>
                    </div>
                    <div class="output-note" data-demo-note="demo-step-4">–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞. –£ —Ç–µ–±—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–∞—á–µ ‚Äî —ç—Ç–æ
                        –Ω–æ—Ä–º–∞–ª—å–Ω–æ.</div>

                    <div class="mini-block expect">
                        <div class="mini-title">‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è</div>
                        –ê–≥–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–≤–æ–¥ <code>ls</code>/<code>cat</code>, –∞ –∑–∞—Ç–µ–º –∫–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç.
                    </div>

                    <div class="mini-block trouble">
                        <div class="mini-title">üßØ –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                        –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ ‚Äî –ø–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
                        –ï—Å–ª–∏ <code>read_file</code> –ø–∞–¥–∞–µ—Ç ‚Äî —ç—Ç–æ –±–∞–≥ —Å <code>require</code> –≤ ESM, –∞–≥–µ–Ω—Ç –æ–±–æ–π–¥—ë—Ç —á–µ—Ä–µ–∑ <code>cat</code>.
                    </div>

                    <div class="key-insight">
                        <strong>üí° Resilience –∞–≥–µ–Ω—Ç–∞ ‚Äî —Ä–µ–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è:</strong>
                        –í ESM-–∫–æ–Ω—Ç–µ–∫—Å—Ç–µ <code>require</code> –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ê–≥–µ–Ω—Ç –≤—ã–∑–≤–∞–ª <code>read_file</code>, –ø–æ–ª—É—á–∏–ª
                        –æ—à–∏–±–∫—É ‚Äî
                        –∏ –Ω–µ —Å–ª–æ–º–∞–ª—Å—è. –û–Ω –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª—Å—è –Ω–∞ <code>cat</code> —á–µ—Ä–µ–∑ <code>run_bash</code>, –ø—Ä–æ—á–∏—Ç–∞–ª
                        —Ñ–∞–π–ª –∏ –ø—Ä–æ–¥–æ–ª–∂–∏–ª —Ä–∞–±–æ—Ç—É.
                        LLM –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –æ—à–∏–±–∫–∞–º ‚Äî —ç—Ç–æ –æ–¥–Ω–∞ –∏–∑ –µ–≥–æ —Å—É–ø–µ—Ä—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π.
                        –¢—ã –º–æ–∂–µ—à—å –¥–∞–∂–µ –Ω–µ —Ñ–∏–∫—Å–∏—Ç—å –±–∞–≥: –∞–≥–µ–Ω—Ç –Ω–∞–π–¥—ë—Ç –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å —Å–∞–º.
                    </div>
                </div>
            </div>
        </div>

<!-- –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∞ -->
<script type="application/json" data-demo-steps="step4">
[
    {
        "label": "–ò—Ç–µ—Ä–∞—Ü–∏—è 1",
        "messages": [
            {
                "role": "user",
                "text": "–ü–æ—Å–º–æ—Ç—Ä–∏ —á—Ç–æ –∑–∞ –ø—Ä–æ–µ–∫—Ç –ª–µ–∂–∏—Ç –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –ö–∞–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã?"
            },
            {
                "role": "tool_call",
                "text": "run_bash({\"command\":\"ls -la\"})"
            },
            {
                "role": "tool_result",
                "text": "total 424\ndrwxr-xr-x   11 human  staff     352 Feb  5 19:57 .\ndrwxr-xr-x  110 human  staff    3520 Feb  5 17:19 ..\n-rw-r--r--@   1 human  staff      93 Feb  5 17:57 .env\ndrwxr-xr-x@  14 ..."
            },
            {
                "role": "tool_call",
                "text": "run_bash({\"command\":\"pwd\"})"
            },
            {
                "role": "tool_result",
                "text": "/Users/human/code/ai_agents_book..."
            }
        ]
    },
    {
        "label": "–ò—Ç–µ—Ä–∞—Ü–∏—è 2",
        "messages": [
            {
                "role": "tool_call",
                "text": "read_file({\"path\":\"package.json\"})"
            },
            {
                "role": "tool_result",
                "text": "{\n  \"name\": \"ai_agents_book\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"repository\": {\n    \"type..."
            },
            {
                "role": "tool_call",
                "text": "run_bash({\"command\":\"head -20 index.html\"})"
            },
            {
                "role": "tool_result",
                "text": "<!DOCTYPE html>\n<html lang=\"ru\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>–ò–ò-–∞–≥–µ–Ω—Ç—ã –¥–ª—è —Å–∞–º—ã—Ö –º–∞–ª–µ–Ω—å–∫–∏—Ö ‚Äî –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —É..."
            },
            {
                "role": "tool_call",
                "text": "run_bash({\"command\":\"ls -la src/\"})"
            },
            {
                "role": "tool_result",
                "text": "total 152\ndrwxr-xr-x@ 10 human  staff    320 Feb  5 18:47 .\ndrwxr-xr-x  11 human  staff    352 Feb  5 19:57 ..\n-rw-r--r--@  1 human  staff    538 Feb  5 18:47 01-basic-call.ts\n-rw-r--r--@  1 ..."
            }
        ]
    },
    {
        "label": "–ò—Ç–µ—Ä–∞—Ü–∏—è 3",
        "messages": [
            {
                "role": "tool_call",
                "text": "run_bash({\"command\":\"ls -la node_modules/\"})"
            },
            {
                "role": "tool_result",
                "text": "total 8\ndrwxr-xr-x@   6 human  staff   192 Feb  5 19:19 .\ndrwxr-xr-x   11 human  staff   352 Feb  5 19:57 ..\ndrwxr-xr-x@   3 human  staff    96 Feb  5 19:19 .bin\n-rw-r--r--@   1 human  sta..."
            }
        ]
    },
    {
        "label": "–ò—Ç–æ–≥",
        "messages": [
            {
                "role": "llm",
                "text": "## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞\n\n–í —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–æ–µ–∫—Ç **\"ai_agents_book\"** - —ç—Ç–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —É—á–µ–±–Ω–∏–∫ \"–ò–ò-–∞–≥–µ–Ω—Ç—ã –¥–ª—è —Å–∞–º—ã—Ö –º–∞–ª–µ–Ω—å–∫–∏—Ö\".\n\n### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:\n- üìÅ **src/** - —Å–æ–¥–µ—Ä–∂–∏—Ç 8 TypeScript —Ñ–∞–π–ª–æ–≤ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∞–≥–µ–Ω—Ç–æ–≤ (–æ—Ç –±–∞–∑–æ–≤—ã—Ö –¥–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö)\n- üìÑ **index.html** - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤–µ–±-—É—á–µ–±–Ω–∏–∫ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ\n- üìÑ **package.json** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è npm –ø—Ä–æ–µ–∫—Ç–∞\n- üìÑ **.env** - —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è\n- üìÅ **.git/** - Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π\n\n### –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:\n\n–°–æ–≥–ª–∞—Å–Ω–æ `package.json`, –≤ –ø—Ä–æ–µ–∫—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã **2 –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:\n\n1. **`dotenv`** (–≤–µ—Ä—Å–∏—è ^17.2.3) - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞\n2. **`openai`** (–≤–µ—Ä—Å–∏—è ^6.17.0) - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ OpenAI API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å GPT –º–æ–¥–µ–ª—è–º–∏\n\n### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ:\n–ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—è –ò–ò-–∞–≥–µ–Ω—Ç–æ–≤:\n- 01-basic-call.ts - –±–∞–∑–æ–≤—ã–π –≤—ã–∑–æ–≤ API\n- 02-with-tool.ts - —Ä–∞–±–æ—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏\n- 03-agent-loop.ts - —Ü–∏–∫–ª –∞–≥–µ–Ω—Ç–∞\n- 04-real-tools.ts - —Ä–µ–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã\n- 05-skills.ts - –Ω–∞–≤—ã–∫–∏ –∞–≥–µ–Ω—Ç–∞\n- 06-planning.ts - –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π\n- 07-adaptive-agent.ts - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∞–≥–µ–Ω—Ç\n- 08-interactive-agent.ts - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∞–≥–µ–Ω—Ç\n\n–≠—Ç–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ò–ò-–∞–≥–µ–Ω—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OpenAI API! ü§ñ"
            }
        ]
    }
]
</script>
